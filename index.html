<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Curriculum Tracker - Avanti Fellows</title>
  
  <!-- ‚úÖ VERSION 5.2.0 - PERFORMANCE: Removed Tailwind CDN, Fixed CLS, Optimized LCP -->
  <script>
    window.__PERF_START = performance.now();
    console.log('üöÄ Curriculum Tracker v5.2.0 - Performance Optimized: CLS + LCP + INP');
  </script>
  
  <!-- ‚úÖ AUTOMATIC CACHE CLEAR - Teachers don't need to do anything -->
  <!-- When version changes, this clears ALL caches and force-reloads ONCE -->
  <script>
    (function() {
      var APP_VERSION = '5.2.0';
      var storedVersion = localStorage.getItem('appCacheVersion');
      
      // If version changed, nuke everything and reload
      if (storedVersion !== APP_VERSION) {
        console.log('[AutoUpdate] Version changed: ' + (storedVersion || 'none') + ' ‚Üí ' + APP_VERSION);
        
        // 1. Clear all Service Worker caches
        if ('caches' in window) {
          caches.keys().then(function(names) {
            names.forEach(function(name) {
              caches.delete(name);
              console.log('[AutoUpdate] Deleted cache:', name);
            });
          });
        }
        
        // 2. Unregister all service workers
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            registrations.forEach(function(registration) {
              registration.unregister();
              console.log('[AutoUpdate] Unregistered service worker');
            });
          });
        }
        
        // 3. Preserve critical user data
        var preserve = {
          studentSession: localStorage.getItem('studentSession'),
          authToken: localStorage.getItem('authToken'),
          avanti_device_id: localStorage.getItem('avanti_device_id'),
          darkMode: localStorage.getItem('darkMode')
        };
        
        // 4. Clear ALL localStorage (removes old cached data)
        localStorage.clear();
        
        // 5. Restore preserved data
        if (preserve.studentSession) localStorage.setItem('studentSession', preserve.studentSession);
        if (preserve.authToken) localStorage.setItem('authToken', preserve.authToken);
        if (preserve.avanti_device_id) localStorage.setItem('avanti_device_id', preserve.avanti_device_id);
        if (preserve.darkMode) localStorage.setItem('darkMode', preserve.darkMode);
        
        // 6. Store new version BEFORE reload
        localStorage.setItem('appCacheVersion', APP_VERSION);
        
        // 7. Force reload ONCE (sessionStorage prevents loop)
        if (!sessionStorage.getItem('autoUpdated')) {
          sessionStorage.setItem('autoUpdated', 'true');
          console.log('[AutoUpdate] Reloading with clean cache...');
          // Add cache-bust parameter to force fresh download of ALL files
          var url = window.location.pathname + '?v=' + APP_VERSION + '.' + Date.now();
          window.location.replace(url);
          return; // Stop executing - page will reload
        }
      }
      
      // Store version for future checks
      if (!storedVersion) localStorage.setItem('appCacheVersion', APP_VERSION);
      
      // Make version available globally
      window.APP_VERSION = APP_VERSION;
    })();
  </script>
  
  <!-- ‚úÖ PERFORMANCE: Resource hints for faster connections -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <!-- REMOVED: Tailwind CDN preconnect - using tailwind-static.css instead -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://identitytoolkit.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="https://firestore.googleapis.com">
  <link rel="dns-prefetch" href="https://identitytoolkit.googleapis.com">

  <!-- ‚úÖ PERFORMANCE: Preload critical scripts for faster download -->
  <link rel="preload" href="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" as="script">
  <link rel="preload" href="https://unpkg.com/react@18/umd/react.production.min.js" as="script">
  <link rel="preload" href="/tailwind-static.css?v=5.2.0" as="style">
  <link rel="preload" href="/app.js?v=5.2.0" as="script">
  <link rel="preload" href="/init.js?v=5.2.0" as="script">
  
  <!-- ‚úÖ APP SHELL ARCHITECTURE: Critical CSS inline for INSTANT UI display -->
  <!-- This CSS loads the entire UI structure before any JavaScript runs -->
  <style id="critical-css">
    /* ========================================
       APP SHELL - INSTANT LOAD UI
       This shows the actual app structure immediately,
       just like Instagram and Twitter do.
       ======================================== */
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    /* ‚úÖ PERFORMANCE FIX: Prevent Cumulative Layout Shift (CLS) */
    /* Reserve space for dynamic content to prevent layout shifts */
    html, body {
      overflow-x: hidden;
    }
    
    /* ‚úÖ FIX CLS: Set explicit dimensions for common elements */
    img {
      max-width: 100%;
      height: auto;
      /* Prevent layout shift when images load */
      content-visibility: auto;
    }
    
    /* ‚úÖ FIX CLS: Reserve space for notification bell */
    .notification-bell {
      min-width: 44px;
      min-height: 44px;
    }
    
    /* ‚úÖ FIX CLS: Reserve space for avatar */
    .shell-avatar, .user-avatar, [class*="avatar"] {
      min-width: 44px;
      min-height: 44px;
      aspect-ratio: 1/1;
    }
    
    /* ‚úÖ FIX CLS: Prevent font-related layout shifts */
    body {
      font-synthesis: none;
      -webkit-font-smoothing: antialiased;
    }
    
    /* ‚úÖ FIX: Ensure all interactive elements are clickable */
    button, a, input, select, textarea, [role="button"], [onclick] {
      pointer-events: auto !important;
      cursor: pointer;
      -webkit-tap-highlight-color: rgba(0,0,0,0.1);
      touch-action: manipulation;
    }
    
    /* ‚úÖ FIX: Ensure buttons have proper z-index and are not covered */
    button {
      position: relative;
      z-index: 10;
    }
    
    /* ‚úÖ CRITICAL FIX: These buttons must ALWAYS be clickable no matter what */
    /* Override any disabled state or pointer-events blocking */
    .close-btn,
    .sidebar-logout,
    .notification-bell,
    .floating-celebration-card .close-btn,
    .online-status-card .close-btn,
    [class*="close-btn"],
    button[onclick*="close"],
    button[onclick*="Logout"],
    button[onclick*="setIsVisible"] {
      pointer-events: auto !important;
      z-index: 10001 !important;
      position: relative !important;
      opacity: 1 !important;
      cursor: pointer !important;
    }
    
    /* ‚úÖ Override the global saving disabled class for critical buttons */
    .close-btn.__global_saving_disabled,
    .sidebar-logout.__global_saving_disabled,
    .notification-bell.__global_saving_disabled {
      pointer-events: auto !important;
      opacity: 1 !important;
      cursor: pointer !important;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }
    
    /* App Shell Container - shows immediately as overlay */
    .app-shell {
      display: flex;
      min-height: 100vh;
      opacity: 1;
      transition: opacity 0.3s ease;
      /* ‚úÖ CLS FIX: Position as fixed overlay ‚Äî hiding won't shift layout */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      contain: layout style;
    }
    
    .app-shell.hidden {
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
    }
    
    /* Sidebar Shell */
    .shell-sidebar {
      width: 220px;
      background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      z-index: 100;
    }
    
    .shell-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 20px;
    }
    
    .shell-logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #F4B41A 0%, #C8342E 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .shell-logo-text {
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
    
    .shell-nav {
      flex: 1;
      padding: 0 10px;
    }
    
    .shell-nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 10px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 4px;
      font-size: 14px;
    }
    
    .shell-nav-item.active {
      background: rgba(244, 180, 26, 0.2);
      color: #F4B41A;
    }
    
    .shell-nav-icon {
      width: 20px;
      text-align: center;
    }
    
    /* Main Content Shell */
    .shell-main {
      flex: 1;
      margin-left: 220px;
      padding: 24px;
      min-height: 100vh;
      /* ‚úÖ PERFORMANCE: Isolate paint for better performance */
      contain: layout paint;
    }
    
    /* Header Shell */
    .shell-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .shell-title {
      font-size: 28px;
      font-weight: bold;
      color: #1a1a2e;
    }
    
    .shell-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .shell-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #F4B41A 0%, #C8342E 100%);
    }
    
    /* ========================================
       SKELETON LOADING ANIMATIONS
       These pulse to show content is loading
       ======================================== */
    
    @keyframes skeleton-pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.8; }
    }
    
    @keyframes skeleton-shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .skeleton {
      background: linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%);
      background-size: 200% 100%;
      animation: skeleton-shimmer 1.5s ease-in-out infinite;
      border-radius: 8px;
    }
    
    .skeleton-text {
      height: 14px;
      margin-bottom: 8px;
      border-radius: 4px;
    }
    
    .skeleton-text.short { width: 60%; }
    .skeleton-text.medium { width: 80%; }
    .skeleton-text.long { width: 100%; }
    
    /* Stats Cards Skeleton */
    .shell-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .shell-stat-card {
      padding: 20px;
      border-radius: 16px;
      color: white;
      min-height: 120px;
    }
    
    .shell-stat-card.yellow {
      background: linear-gradient(135deg, #F4B41A 0%, #E8A000 100%);
    }
    
    .shell-stat-card.green {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    }
    
    .shell-stat-card.red {
      background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
    }
    
    .shell-stat-label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    
    .shell-stat-value {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .shell-stat-sub {
      font-size: 12px;
      opacity: 0.8;
    }
    
    /* Content Cards Skeleton */
    .shell-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .shell-card-title {
      font-size: 20px;
      font-weight: bold;
      color: #1a1a2e;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Rankings Skeleton */
    .shell-ranking-item {
      display: flex;
      align-items: center;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 8px;
      background: #f9f9f9;
    }
    
    .shell-ranking-num {
      width: 32px;
      font-size: 18px;
      font-weight: bold;
      color: #999;
    }
    
    .shell-ranking-info {
      flex: 1;
    }
    
    .shell-ranking-percent {
      font-size: 24px;
      font-weight: bold;
      color: #C8342E;
    }
    
    /* Loading Status Indicator */
    .shell-loading-status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #1a1a2e;
      color: white;
      padding: 12px 20px;
      border-radius: 30px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    .shell-loading-status.success {
      background: #22c55e;
    }
    
    .shell-loading-status.hidden {
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
    }
    
    .shell-loading-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .shell-sidebar {
        display: none !important; /* ‚úÖ FIX: Completely hide sidebar on mobile */
      }
      
      .shell-nav {
        display: flex;
        overflow-x: auto;
        gap: 8px;
        padding: 10px 0;
      }
      
      .shell-nav-item {
        flex-shrink: 0;
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .shell-main {
        margin-left: 0 !important;
        padding: 16px;
        padding-top: 70px; /* Space for mobile header */
        padding-bottom: 80px; /* Space for bottom nav */
      }
      
      .shell-title {
        font-size: 22px;
      }
      
      .shell-stats-grid {
        grid-template-columns: 1fr;
      }
      
      .shell-stat-value {
        font-size: 28px;
      }
      
      /* ‚úÖ FIX: Show mobile header in app shell */
      .shell-mobile-header {
        display: flex !important;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 56px;
        background: #1a1a2e;
        align-items: center;
        justify-content: center;
        z-index: 100;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      
      .shell-mobile-header .shell-logo {
        padding: 0;
        border: none;
        margin: 0;
      }
    }
    
    /* Hide app shell when React is ready */
    .app-shell.react-ready {
      display: none !important;
    }
    
    /* ========================================
       LEGACY LOADING SCREEN (fallback)
       Only shows if app shell fails to render
       ======================================== */
    .instant-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #F4B41A 0%, #E8B039 50%, #C8342E 100%);
      display: none; /* Hidden by default - app shell shows instead */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 99999;
    }
    
    .instant-loader.show-fallback {
      display: flex;
    }
    
    .instant-loader-logo {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      animation: pulse 1.5s ease-in-out infinite;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .instant-loader-text {
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 24px;
      font-weight: bold;
      margin-top: 20px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .instant-loader-sub {
      color: rgba(255,255,255,0.9);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 14px;
      margin-top: 8px;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .loader-dots {
      display: flex;
      gap: 8px;
      margin-top: 30px;
    }
    .loader-dot {
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite;
    }
    .loader-dot:nth-child(1) { animation-delay: 0s; }
    .loader-dot:nth-child(2) { animation-delay: 0.2s; }
    .loader-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
    
    /* ‚úÖ NEW: Login button spinner animation */
    .login-spinner {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    .login-spinner-icon {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: login-spin 0.8s linear infinite;
    }
    @keyframes login-spin {
      to { transform: rotate(360deg); }
    }
    .login-progress-text {
      font-size: 16px;
      font-weight: 600;
    }
    
    /* ‚úÖ NEW: iOS fix - prevent stuck loading */
    .loader-timeout-msg {
      color: rgba(255,255,255,0.9);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 13px;
      margin-top: 20px;
      text-align: center;
      max-width: 280px;
      line-height: 1.5;
      display: none;
    }
    .instant-loader.slow-loading .loader-timeout-msg {
      display: block;
    }
    .retry-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid white;
      padding: 10px 24px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 12px;
      transition: all 0.2s;
    }
    .retry-btn:hover, .retry-btn:active {
      background: white;
      color: #C8342E;
    }
  </style>
  
  <!-- ‚úÖ iOS FIX: Force loader timeout after 15 seconds for iOS -->
  <script>
    // iOS detection and early timeout setup
    (function() {
      var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      var isAndroid = /Android/.test(navigator.userAgent);
      var isMobile = isIOS || isAndroid;
      
      // ‚úÖ PERFORMANCE FIX: Reduced timeout for faster perceived performance
      // While keeping room for low-connectivity areas
      var loaderTimeout = isMobile ? 20000 : 25000; // 20s mobile, 25s desktop (was 35/45)
      
      window._loaderTimeoutId = setTimeout(function() {
        var loader = document.getElementById('instant-loader');
        if (loader) {
          loader.classList.add('slow-loading');
        }
      }, loaderTimeout - 10000); // Show "slow loading" message 10s before force hide
      
      // ‚úÖ FIX: Force hide loader after timeout (prevents infinite loading on iOS)
      window._forceHideTimeout = setTimeout(function() {
        var loader = document.getElementById('instant-loader');
        if (loader && loader.parentNode) {
          console.warn('[Loader] Force hiding stuck loader after ' + loaderTimeout + 'ms');
          loader.style.transition = 'opacity 0.3s';
          loader.style.opacity = '0';
          setTimeout(function() { 
            if (loader.parentNode) loader.parentNode.removeChild(loader); 
          }, 300);
        }
      }, loaderTimeout);
      
      // ‚úÖ PERFORMANCE: Track load time for debugging
      window._appLoadStart = Date.now();
      window._logLoadTime = function(stage) {
        console.log('‚è±Ô∏è ' + stage + ': ' + (Date.now() - window._appLoadStart) + 'ms');
      };
      
      // ‚úÖ FIX: Safe localStorage wrapper for iOS private mode
      window.safeStorage = {
        getItem: function(key) {
          try { return localStorage.getItem(key); } 
          catch(e) { return null; }
        },
        setItem: function(key, value) {
          try { localStorage.setItem(key, value); return true; } 
          catch(e) { return false; }
        },
        removeItem: function(key) {
          try { localStorage.removeItem(key); return true; } 
          catch(e) { return false; }
        }
      };
      
      // ‚úÖ NEW: IndexedDB wrapper for persistent storage (survives PWA/APK restarts)
      window.persistentStorage = {
        _db: null,
        _dbName: 'AvantiCurriculumTracker',
        _storeName: 'sessions',
        
        init: function() {
          return new Promise((resolve, reject) => {
            if (this._db) { resolve(this._db); return; }
            if (!window.indexedDB) { reject('IndexedDB not supported'); return; }
            
            const request = indexedDB.open(this._dbName, 2); // Upgraded to v2 for dataCache store
            request.onerror = () => reject(request.error);
            request.onsuccess = () => { this._db = request.result; resolve(this._db); };
            request.onupgradeneeded = (e) => {
              const db = e.target.result;
              if (!db.objectStoreNames.contains(this._storeName)) {
                db.createObjectStore(this._storeName, { keyPath: 'key' });
              }
              // ‚úÖ NEW: Add dataCache store for app data persistence
              if (!db.objectStoreNames.contains('dataCache')) {
                db.createObjectStore('dataCache', { keyPath: 'key' });
              }
            };
          });
        },
        
        getItem: async function(key) {
          try {
            await this.init();
            return new Promise((resolve) => {
              const tx = this._db.transaction(this._storeName, 'readonly');
              const store = tx.objectStore(this._storeName);
              const request = store.get(key);
              request.onsuccess = () => resolve(request.result?.value || null);
              request.onerror = () => resolve(null);
            });
          } catch(e) { return null; }
        },
        
        setItem: async function(key, value) {
          try {
            await this.init();
            return new Promise((resolve) => {
              const tx = this._db.transaction(this._storeName, 'readwrite');
              const store = tx.objectStore(this._storeName);
              store.put({ key, value, timestamp: Date.now() });
              tx.oncomplete = () => resolve(true);
              tx.onerror = () => resolve(false);
            });
          } catch(e) { return false; }
        },
        
        removeItem: async function(key) {
          try {
            await this.init();
            return new Promise((resolve) => {
              const tx = this._db.transaction(this._storeName, 'readwrite');
              const store = tx.objectStore(this._storeName);
              store.delete(key);
              tx.oncomplete = () => resolve(true);
              tx.onerror = () => resolve(false);
            });
          } catch(e) { return false; }
        }
      };
      
      // ========================================
      // ‚úÖ CRITICAL FIX: Enhanced Data Cache Manager
      // Solves "Dashboard showing 0" and "Attendance not showing" issues
      // Uses Cache-First + Background Refresh strategy for low-connectivity areas
      // ========================================
      window.DataCacheManager = {
        _initialized: false,
        _cacheTimestamps: {},
        _dataFreshness: {},
        _memoryCache: {},
        CACHE_MAX_AGE: 24 * 60 * 60 * 1000,
        STALE_THRESHOLD: 2 * 60 * 1000,
        
        init: async function() {
          if (this._initialized) return;
          try {
            await window.persistentStorage.init();
            this._initialized = true;
            console.log('[DataCache] ‚úÖ Initialized successfully');
          } catch(e) {
            console.warn('[DataCache] Init failed, using memory cache only:', e);
          }
        },
        
        getFromMemory: function(key) {
          const cached = this._memoryCache[key];
          if (cached && cached.data && (Date.now() - cached.timestamp) < this.CACHE_MAX_AGE) {
            return cached.data;
          }
          return null;
        },
        
        saveToMemory: function(key, data) {
          this._memoryCache[key] = { data: data, timestamp: Date.now() };
        },
        
        saveToCache: async function(key, data) {
          this.saveToMemory(key, data);
          try {
            await this.init();
            const db = window.persistentStorage._db;
            if (!db) return false;
            
            return new Promise((resolve) => {
              try {
                const tx = db.transaction('dataCache', 'readwrite');
                const store = tx.objectStore('dataCache');
                store.put({ 
                  key, 
                  data,
                  timestamp: Date.now(),
                  userSchool: window._currentUserSchool || 'unknown'
                });
                tx.oncomplete = () => {
                  this._cacheTimestamps[key] = Date.now();
                  console.log('[DataCache] ‚úÖ Saved:', key);
                  resolve(true);
                };
                tx.onerror = () => resolve(false);
              } catch(e) {
                resolve(false);
              }
            });
          } catch(e) { 
            console.warn('[DataCache] Save failed for', key, e);
            return false; 
          }
        },
        
        loadFromCache: async function(key) {
          var memCached = this.getFromMemory(key);
          if (memCached) {
            console.log('[DataCache] ‚úÖ Loaded from memory:', key);
            return memCached;
          }
          try {
            await this.init();
            const db = window.persistentStorage._db;
            if (!db) return null;
            
            return new Promise((resolve) => {
              try {
                const tx = db.transaction('dataCache', 'readonly');
                const store = tx.objectStore('dataCache');
                const request = store.get(key);
                request.onsuccess = () => {
                  const result = request.result;
                  if (result && result.data) {
                    const age = Date.now() - (result.timestamp || 0);
                    // Return cached data if not too old (24 hours max)
                    if (age < this.CACHE_MAX_AGE) {
                      this._cacheTimestamps[key] = result.timestamp;
                      this._dataFreshness[key] = age < this.STALE_THRESHOLD ? 'fresh' : 'stale';
                      console.log('[DataCache] ‚úÖ Loaded from cache:', key, '(age:', Math.round(age/1000), 's)');
                      resolve(result.data);
                      return;
                    }
                  }
                  resolve(null);
                };
                request.onerror = () => resolve(null);
              } catch(e) {
                resolve(null);
              }
            });
          } catch(e) { 
            return null; 
          }
        },
        
        // Check if data is stale
        isStale: function(key) {
          const timestamp = this._cacheTimestamps[key];
          if (!timestamp) return true;
          return (Date.now() - timestamp) > this.STALE_THRESHOLD;
        },
        
        // Get freshness status for UI
        getFreshness: function(key) {
          return this._dataFreshness[key] || 'unknown';
        },
        
        // Clear all cached data (for logout, etc)
        clearAll: async function() {
          try {
            await this.init();
            const db = window.persistentStorage._db;
            if (!db) return;
            
            const tx = db.transaction('dataCache', 'readwrite');
            const store = tx.objectStore('dataCache');
            store.clear();
            this._cacheTimestamps = {};
            this._dataFreshness = {};
            console.log('[DataCache] üóëÔ∏è Cleared all cache');
          } catch(e) {
            console.warn('[DataCache] Clear failed:', e);
          }
        }
      };
      
      // ========================================
      // ‚úÖ CRITICAL FIX: Smart Firebase Query with Retry + Cache
      // Longer timeouts (30s), auto-retry, and cache fallback
      // ========================================
      window.smartFetch = async function(promise, options = {}) {
        const {
          cacheKey = null,
          timeoutMs = 30000, // ‚úÖ Increased from 6-8s to 30s for remote areas
          retries = 3,
          fallback = { docs: [] }
        } = options;
        
        // ‚úÖ STEP 1: Return cached data immediately if available
        let cachedData = null;
        if (cacheKey) {
          cachedData = await window.DataCacheManager.loadFromCache(cacheKey);
          if (cachedData && !window._forceRefresh) {
            console.log('[SmartFetch] ‚úÖ Using cached data for:', cacheKey);
            // Schedule background refresh
            setTimeout(() => {
              window._backgroundRefresh(promise, cacheKey);
            }, 100);
            return cachedData;
          }
        }
        
        // ‚úÖ STEP 2: Try to fetch fresh data with retries
        for (let attempt = 1; attempt <= retries; attempt++) {
          try {
            const result = await Promise.race([
              promise,
              new Promise((_, reject) => setTimeout(() => {
                reject(new Error(`Timeout after ${timeoutMs}ms (attempt ${attempt}/${retries})`));
              }, timeoutMs))
            ]);
            
            // ‚úÖ Success! Save to cache and return
            if (cacheKey && result?.docs) {
              const dataToCache = {
                docs: result.docs.map(d => ({ id: d.id, data: d.data() }))
              };
              window.DataCacheManager.saveToCache(cacheKey, dataToCache);
            }
            
            console.log('[SmartFetch] ‚úÖ Fresh data loaded for:', cacheKey || 'query');
            return result;
            
          } catch (error) {
            console.warn(`[SmartFetch] ‚ö†Ô∏è Attempt ${attempt}/${retries} failed:`, error.message);
            
            // Wait before retry (exponential backoff)
            if (attempt < retries) {
              await new Promise(r => setTimeout(r, 1000 * attempt));
            }
          }
        }
        
        // ‚úÖ STEP 3: All retries failed - use cache if available, otherwise fallback
        if (cachedData) {
          console.log('[SmartFetch] ‚ö†Ô∏è Using stale cache as fallback for:', cacheKey);
          window.DataCacheManager._dataFreshness[cacheKey] = 'stale';
          return cachedData;
        }
        
        console.warn('[SmartFetch] ‚ùå All attempts failed, using empty fallback for:', cacheKey || 'query');
        return fallback;
      };
      
      // Background refresh function (updates cache silently)
      window._backgroundRefresh = async function(promiseFactory, cacheKey) {
        try {
          // Create a new promise instance for background fetch
          const result = await Promise.race([
            typeof promiseFactory === 'function' ? promiseFactory() : promiseFactory,
            new Promise((_, reject) => setTimeout(() => reject(new Error('Background timeout')), 45000))
          ]);
          
          if (result?.docs && cacheKey) {
            const dataToCache = {
              docs: result.docs.map(d => ({ id: d.id, data: d.data() }))
            };
            await window.DataCacheManager.saveToCache(cacheKey, dataToCache);
            window.DataCacheManager._dataFreshness[cacheKey] = 'fresh';
            console.log('[BackgroundRefresh] ‚úÖ Updated cache for:', cacheKey);
            
            // Dispatch event for UI to know fresh data is available
            window.dispatchEvent(new CustomEvent('dataCacheUpdated', { detail: { key: cacheKey } }));
          }
        } catch(e) {
          console.log('[BackgroundRefresh] Background refresh failed:', e.message);
        }
      };
      
      // ‚úÖ Track data loading state globally for UI indicators
      window._dataLoadingState = {
        isLoading: false,
        lastLoadTime: null,
        errors: [],
        setLoading: function(loading) {
          this.isLoading = loading;
          if (!loading) this.lastLoadTime = Date.now();
          window.dispatchEvent(new CustomEvent('dataLoadingStateChange', { detail: this }));
        },
        addError: function(error) {
          this.errors.push({ message: error, time: Date.now() });
          if (this.errors.length > 10) this.errors.shift();
        }
      };
      
      // Initialize DataCache early
      window.DataCacheManager.init().catch(function(e) {
        console.log('[DataCache] Early init skipped:', e);
      });
      
      // Initialize IndexedDB early
      window.persistentStorage.init().catch(function(e) {
        console.log('IndexedDB init skipped:', e);
      });
      
      // ========================================
      // ‚úÖ SMART HYBRID SYNC MANAGER
      // Reduces Firebase costs by 40-50% through intelligent data fetching
      // Features:
      // - Visibility API: Pauses sync when tab is hidden
      // - Tiered Refresh: Different intervals for different data types
      // - Selective Real-time: Only critical data uses listeners
      // - Event-driven sync: Refreshes data when user makes changes
      // ========================================
      window.SmartSyncManager = {
        _initialized: false,
        _isTabVisible: true,
        _syncIntervals: {},
        _realtimeListeners: [],
        _lastSyncTimes: {},
        _pendingSync: new Set(),
        _manualRefreshCallback: null,
        
        // Tiered refresh intervals (in milliseconds)
        // Longer intervals = fewer Firebase reads = lower cost
        SYNC_INTERVALS: {
          // Critical: Data that changes frequently during school hours
          attendance: 10 * 60 * 1000,       // 10 minutes - attendance is time-sensitive
          todayAttendance: 5 * 60 * 1000,   // 5 minutes - today's attendance more frequent
          
          // Medium: Data that changes occasionally
          curriculum: 30 * 60 * 1000,       // 30 minutes - curriculum rarely changes
          teachers: 60 * 60 * 1000,         // 1 hour - teacher list rarely changes
          students: 60 * 60 * 1000,         // 1 hour - student list rarely changes
          
          // Low priority: Data that changes very rarely
          schools: 2 * 60 * 60 * 1000,      // 2 hours - school list almost never changes
          rankings: 60 * 60 * 1000,         // 1 hour - computed data
          managers: 2 * 60 * 60 * 1000,     // 2 hours - manager list rarely changes
          settings: 60 * 60 * 1000          // 1 hour - settings rarely change
        },
        
        // School hours (IST) - more frequent syncing during these hours
        SCHOOL_HOURS: {
          start: 8,   // 8 AM
          end: 17     // 5 PM
        },
        
        // Initialize the Smart Sync Manager
        init: function() {
          if (this._initialized) return;
          this._initialized = true;
          
          console.log('[SmartSync] ‚úÖ Initializing Smart Hybrid Sync Manager');
          
          // Set up Visibility API listener
          this._setupVisibilityListener();
          
          // Set up online/offline listener
          this._setupNetworkListener();
          
          // Load last sync times from storage
          this._loadLastSyncTimes();
          
          console.log('[SmartSync] ‚úÖ Initialized successfully');
        },
        
        // Setup visibility listener - PAUSE sync when tab is hidden
        _setupVisibilityListener: function() {
          var self = this;
          
          // Handle visibility change
          document.addEventListener('visibilitychange', function() {
            self._isTabVisible = !document.hidden;
            
            if (document.hidden) {
              console.log('[SmartSync] üîá Tab hidden - pausing background sync');
              self._pauseAllIntervals();
            } else {
              console.log('[SmartSync] üîä Tab visible - resuming sync');
              self._resumeAllIntervals();
              
              // Check if any sync is overdue and trigger it
              self._checkOverdueSyncs();
            }
          });
          
          // Also pause when window loses focus (for mobile)
          window.addEventListener('blur', function() {
            // Don't immediately pause - user might be switching briefly
            self._blurTimeout = setTimeout(function() {
              if (!self._isTabVisible) {
                console.log('[SmartSync] Window blurred for extended time');
              }
            }, 30000); // 30 seconds
          });
          
          window.addEventListener('focus', function() {
            if (self._blurTimeout) {
              clearTimeout(self._blurTimeout);
              self._blurTimeout = null;
            }
            self._checkOverdueSyncs();
          });
          
          console.log('[SmartSync] ‚úÖ Visibility listener active');
        },
        
        // Setup network listener
        _setupNetworkListener: function() {
          var self = this;
          
          window.addEventListener('online', function() {
            console.log('[SmartSync] üåê Back online - syncing pending data');
            self._syncPendingData();
          });
          
          window.addEventListener('offline', function() {
            console.log('[SmartSync] üì¥ Offline - queuing sync requests');
          });
        },
        
        // Load last sync times from localStorage
        _loadLastSyncTimes: function() {
          try {
            var saved = localStorage.getItem('smartSync_lastTimes');
            if (saved) {
              this._lastSyncTimes = JSON.parse(saved);
            }
          } catch(e) {
            this._lastSyncTimes = {};
          }
        },
        
        // Save last sync times to localStorage
        _saveLastSyncTimes: function() {
          try {
            localStorage.setItem('smartSync_lastTimes', JSON.stringify(this._lastSyncTimes));
          } catch(e) {}
        },
        
        // Check if we're in school hours (more frequent syncing)
        isSchoolHours: function() {
          var now = new Date();
          var hour = now.getHours();
          return hour >= this.SCHOOL_HOURS.start && hour < this.SCHOOL_HOURS.end;
        },
        
        // Get adjusted interval based on school hours
        getAdjustedInterval: function(dataType) {
          var baseInterval = this.SYNC_INTERVALS[dataType] || 30 * 60 * 1000;
          
          // During school hours, use normal intervals
          // Outside school hours, double the intervals (less frequent = lower cost)
          if (!this.isSchoolHours()) {
            return baseInterval * 2;
          }
          
          return baseInterval;
        },
        
        // Check if data type needs sync
        needsSync: function(dataType) {
          var lastSync = this._lastSyncTimes[dataType] || 0;
          var interval = this.getAdjustedInterval(dataType);
          return (Date.now() - lastSync) > interval;
        },
        
        // Mark data type as synced
        markSynced: function(dataType) {
          this._lastSyncTimes[dataType] = Date.now();
          this._saveLastSyncTimes();
          console.log('[SmartSync] ‚úÖ Synced:', dataType);
        },
        
        // Pause all sync intervals (when tab hidden)
        _pauseAllIntervals: function() {
          var self = this;
          Object.keys(this._syncIntervals).forEach(function(key) {
            if (self._syncIntervals[key]) {
              clearInterval(self._syncIntervals[key]);
              self._syncIntervals[key] = null;
            }
          });
        },
        
        // Resume all sync intervals (when tab visible)
        _resumeAllIntervals: function() {
          // Intervals will be re-created by the main app
          // This just ensures we're ready to accept them
        },
        
        // Check for overdue syncs when tab becomes visible
        _checkOverdueSyncs: function() {
          var self = this;
          var overdue = [];
          
          Object.keys(this.SYNC_INTERVALS).forEach(function(dataType) {
            if (self.needsSync(dataType)) {
              overdue.push(dataType);
            }
          });
          
          if (overdue.length > 0) {
            console.log('[SmartSync] üìä Overdue syncs:', overdue.join(', '));
            // Trigger manual refresh if callback is set
            if (this._manualRefreshCallback) {
              this._manualRefreshCallback(overdue);
            }
          }
        },
        
        // Sync pending data when back online
        _syncPendingData: function() {
          if (this._pendingSync.size > 0 && this._manualRefreshCallback) {
            console.log('[SmartSync] üì§ Syncing pending:', Array.from(this._pendingSync));
            this._manualRefreshCallback(Array.from(this._pendingSync));
            this._pendingSync.clear();
          }
        },
        
        // Register a sync interval
        registerInterval: function(dataType, callback) {
          var self = this;
          
          // Clear existing interval if any
          if (this._syncIntervals[dataType]) {
            clearInterval(this._syncIntervals[dataType]);
          }
          
          var interval = this.getAdjustedInterval(dataType);
          
          this._syncIntervals[dataType] = setInterval(function() {
            // Only sync if tab is visible
            if (self._isTabVisible && navigator.onLine) {
              console.log('[SmartSync] ‚è∞ Scheduled sync:', dataType);
              callback();
              self.markSynced(dataType);
            } else if (!navigator.onLine) {
              self._pendingSync.add(dataType);
            }
          }, interval);
          
          console.log('[SmartSync] ‚è±Ô∏è Registered interval:', dataType, '(' + Math.round(interval/60000) + ' min)');
        },
        
        // Clear a sync interval
        clearInterval: function(dataType) {
          if (this._syncIntervals[dataType]) {
            clearInterval(this._syncIntervals[dataType]);
            this._syncIntervals[dataType] = null;
          }
        },
        
        // Register a real-time listener (selective - only for critical data)
        registerRealtimeListener: function(unsubscribeFn) {
          this._realtimeListeners.push(unsubscribeFn);
        },
        
        // Clear all real-time listeners
        clearAllRealtimeListeners: function() {
          this._realtimeListeners.forEach(function(unsubscribe) {
            if (typeof unsubscribe === 'function') {
              unsubscribe();
            }
          });
          this._realtimeListeners = [];
        },
        
        // Set manual refresh callback
        setRefreshCallback: function(callback) {
          this._manualRefreshCallback = callback;
        },
        
        // Get sync status for debugging
        getStatus: function() {
          return {
            initialized: this._initialized,
            tabVisible: this._isTabVisible,
            online: navigator.onLine,
            isSchoolHours: this.isSchoolHours(),
            lastSyncTimes: this._lastSyncTimes,
            activeIntervals: Object.keys(this._syncIntervals).filter(function(k) {
              return window.SmartSyncManager._syncIntervals[k] !== null;
            }),
            pendingSync: Array.from(this._pendingSync)
          };
        },
        
        // Force sync all data (manual refresh)
        forceSync: function() {
          console.log('[SmartSync] üîÑ Force sync requested');
          if (this._manualRefreshCallback) {
            this._manualRefreshCallback(['all']);
          }
        }
      };
      
      // Initialize SmartSyncManager
      window.SmartSyncManager.init();
    })();
  </script>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#F4B41A">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Curriculum Tracker">
  <link rel="apple-touch-icon" href="/Icon-192.png">
  
  <!-- ‚úÖ PERFORMANCE: Defer FontAwesome - not critical for initial render -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" media="print" onload="this.media='all'" />

  <!-- ‚úÖ PERFORMANCE v5.2.0: All scripts moved to defer for parallel download -->
  <!-- Firebase, React, Tailwind, and app code load after HTML parsing -->
  <!-- CSS preload for Tailwind -->
  <link rel="stylesheet" href="/tailwind-static.css?v=5.2.0">
  
  <!-- ‚úÖ FIX: Tailwind fallback CSS - ensures app works even if CDN fails -->
  <!-- Critical for teachers in JNVs 30-40km from cities with poor signals -->
  <style id="tailwind-fallback">
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .flex-1 { flex: 1 1 0%; }
    .flex-wrap { flex-wrap: wrap; }
    .flex-shrink-0 { flex-shrink: 0; }
    .items-center { align-items: center; }
    .items-start { align-items: flex-start; }
    .items-end { align-items: flex-end; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .justify-end { justify-content: flex-end; }
    .gap-1 { gap: 0.25rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .gap-6 { gap: 1.5rem; }
    .p-1 { padding: 0.25rem; }
    .p-2 { padding: 0.5rem; }
    .p-3 { padding: 0.75rem; }
    .p-4 { padding: 1rem; }
    .p-5 { padding: 1.25rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }
    .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .px-5 { padding-left: 1.25rem; padding-right: 1.25rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .pt-2 { padding-top: 0.5rem; }
    .pt-4 { padding-top: 1rem; }
    .pb-2 { padding-bottom: 0.5rem; }
    .pb-4 { padding-bottom: 1rem; }
    .pl-4 { padding-left: 1rem; }
    .pr-4 { padding-right: 1rem; }
    .m-2 { margin: 0.5rem; }
    .m-4 { margin: 1rem; }
    .mb-1 { margin-bottom: 0.25rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }
    .ml-1 { margin-left: 0.25rem; }
    .ml-2 { margin-left: 0.5rem; }
    .ml-auto { margin-left: auto; }
    .mr-1 { margin-right: 0.25rem; }
    .mr-2 { margin-right: 0.5rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .-mt-1 { margin-top: -0.25rem; }
    .w-full { width: 100%; }
    .w-auto { width: auto; }
    .w-4 { width: 1rem; }
    .w-5 { width: 1.25rem; }
    .w-6 { width: 1.5rem; }
    .w-8 { width: 2rem; }
    .w-10 { width: 2.5rem; }
    .w-12 { width: 3rem; }
    .w-16 { width: 4rem; }
    .w-20 { width: 5rem; }
    .w-24 { width: 6rem; }
    .w-32 { width: 8rem; }
    .w-48 { width: 12rem; }
    .w-64 { width: 16rem; }
    .h-full { height: 100%; }
    .h-4 { height: 1rem; }
    .h-5 { height: 1.25rem; }
    .h-6 { height: 1.5rem; }
    .h-8 { height: 2rem; }
    .h-10 { height: 2.5rem; }
    .h-12 { height: 3rem; }
    .h-16 { height: 4rem; }
    .h-20 { height: 5rem; }
    .h-2 { height: 0.5rem; }
    .h-3 { height: 0.75rem; }
    .min-h-screen { min-height: 100vh; }
    .max-w-md { max-width: 28rem; }
    .max-w-lg { max-width: 32rem; }
    .max-w-xl { max-width: 36rem; }
    .max-w-2xl { max-width: 42rem; }
    .max-w-4xl { max-width: 56rem; }
    .max-w-full { max-width: 100%; }
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-base { font-size: 1rem; line-height: 1.5rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    .font-extrabold { font-weight: 800; }
    .italic { font-style: italic; }
    .text-left { text-align: left; }
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .uppercase { text-transform: uppercase; }
    .lowercase { text-transform: lowercase; }
    .capitalize { text-transform: capitalize; }
    .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .whitespace-nowrap { white-space: nowrap; }
    .whitespace-pre-wrap { white-space: pre-wrap; }
    .break-words { overflow-wrap: break-word; }
    .leading-tight { line-height: 1.25; }
    .leading-relaxed { line-height: 1.625; }
    .tracking-wide { letter-spacing: 0.025em; }
    .text-white { color: white; }
    .text-black { color: black; }
    .text-gray-300 { color: #d1d5db; }
    .text-gray-400 { color: #9ca3af; }
    .text-gray-500 { color: #6b7280; }
    .text-gray-600 { color: #4b5563; }
    .text-gray-700 { color: #374151; }
    .text-gray-800 { color: #1f2937; }
    .text-gray-900 { color: #111827; }
    .text-red-500 { color: #ef4444; }
    .text-red-600 { color: #dc2626; }
    .text-red-700 { color: #b91c1c; }
    .text-green-400 { color: #4ade80; }
    .text-green-500 { color: #22c55e; }
    .text-green-600 { color: #16a34a; }
    .text-green-700 { color: #15803d; }
    .text-blue-500 { color: #3b82f6; }
    .text-blue-600 { color: #2563eb; }
    .text-blue-700 { color: #1d4ed8; }
    .text-yellow-500 { color: #eab308; }
    .text-yellow-600 { color: #ca8a04; }
    .text-yellow-700 { color: #a16207; }
    .text-orange-500 { color: #f97316; }
    .text-orange-600 { color: #ea580c; }
    .text-purple-500 { color: #a855f7; }
    .text-purple-600 { color: #9333ea; }
    .text-purple-700 { color: #7e22ce; }
    .text-pink-500 { color: #ec4899; }
    .text-pink-600 { color: #db2777; }
    .text-amber-500 { color: #f59e0b; }
    .text-amber-600 { color: #d97706; }
    .text-teal-600 { color: #0d9488; }
    .text-indigo-600 { color: #4f46e5; }
    .text-cyan-600 { color: #0891b2; }
    .bg-white { background-color: white; }
    .bg-black { background-color: black; }
    .bg-gray-50 { background-color: #f9fafb; }
    .bg-gray-100 { background-color: #f3f4f6; }
    .bg-gray-200 { background-color: #e5e7eb; }
    .bg-gray-300 { background-color: #d1d5db; }
    .bg-gray-400 { background-color: #9ca3af; }
    .bg-gray-500 { background-color: #6b7280; }
    .bg-gray-600 { background-color: #4b5563; }
    .bg-gray-800 { background-color: #1f2937; }
    .bg-gray-900 { background-color: #111827; }
    .bg-red-50 { background-color: #fef2f2; }
    .bg-red-100 { background-color: #fee2e2; }
    .bg-red-500 { background-color: #ef4444; }
    .bg-red-600 { background-color: #dc2626; }
    .bg-green-50 { background-color: #f0fdf4; }
    .bg-green-100 { background-color: #dcfce7; }
    .bg-green-500 { background-color: #22c55e; }
    .bg-green-600 { background-color: #16a34a; }
    .bg-blue-50 { background-color: #eff6ff; }
    .bg-blue-100 { background-color: #dbeafe; }
    .bg-blue-200 { background-color: #bfdbfe; }
    .bg-blue-400 { background-color: #60a5fa; }
    .bg-blue-500 { background-color: #3b82f6; }
    .bg-blue-600 { background-color: #2563eb; }
    .bg-blue-700 { background-color: #1d4ed8; }
    .bg-yellow-50 { background-color: #fefce8; }
    .bg-yellow-100 { background-color: #fef9c3; }
    .bg-yellow-400 { background-color: #facc15; }
    .bg-yellow-500 { background-color: #eab308; }
    .bg-yellow-600 { background-color: #ca8a04; }
    .bg-yellow-700 { background-color: #a16207; }
    .bg-orange-50 { background-color: #fff7ed; }
    .bg-orange-100 { background-color: #ffedd5; }
    .bg-orange-500 { background-color: #f97316; }
    .bg-orange-600 { background-color: #ea580c; }
    .bg-purple-50 { background-color: #faf5ff; }
    .bg-purple-100 { background-color: #f3e8ff; }
    .bg-purple-200 { background-color: #e9d5ff; }
    .bg-purple-500 { background-color: #a855f7; }
    .bg-purple-600 { background-color: #9333ea; }
    .bg-purple-700 { background-color: #7e22ce; }
    .bg-pink-50 { background-color: #fdf2f8; }
    .bg-pink-100 { background-color: #fce7f3; }
    .bg-pink-200 { background-color: #fbcfe8; }
    .bg-pink-300 { background-color: #f9a8d4; }
    .bg-pink-500 { background-color: #ec4899; }
    .bg-pink-600 { background-color: #db2777; }
    .bg-amber-50 { background-color: #fffbeb; }
    .bg-amber-300 { background-color: #fcd34d; }
    .bg-amber-500 { background-color: #f59e0b; }
    .bg-teal-100 { background-color: #ccfbf1; }
    .bg-teal-200 { background-color: #99f6e4; }
    .bg-indigo-50 { background-color: #eef2ff; }
    .bg-indigo-600 { background-color: #4f46e5; }
    .bg-cyan-50 { background-color: #ecfeff; }
    .bg-cyan-600 { background-color: #0891b2; }
    .bg-sky-50 { background-color: #f0f9ff; }
    .bg-gradient-to-r { background-image: linear-gradient(to right, var(--tw-gradient-stops)); }
    .bg-gradient-to-br { background-image: linear-gradient(to bottom right, var(--tw-gradient-stops)); }
    .from-yellow-400 { --tw-gradient-from: #facc15; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, transparent); }
    .from-purple-500 { --tw-gradient-from: #a855f7; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, transparent); }
    .from-blue-500 { --tw-gradient-from: #3b82f6; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, transparent); }
    .to-orange-500 { --tw-gradient-to: #f97316; }
    .to-pink-500 { --tw-gradient-to: #ec4899; }
    .to-purple-600 { --tw-gradient-to: #9333ea; }
    .bg-opacity-20 { --tw-bg-opacity: 0.2; }
    .bg-opacity-30 { --tw-bg-opacity: 0.3; }
    .bg-opacity-50 { --tw-bg-opacity: 0.5; }
    .bg-opacity-75 { --tw-bg-opacity: 0.75; }
    .rounded { border-radius: 0.25rem; }
    .rounded-md { border-radius: 0.375rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-2xl { border-radius: 1rem; }
    .rounded-3xl { border-radius: 1.5rem; }
    .rounded-full { border-radius: 9999px; }
    .rounded-t-xl { border-top-left-radius: 0.75rem; border-top-right-radius: 0.75rem; }
    .rounded-b-xl { border-bottom-left-radius: 0.75rem; border-bottom-right-radius: 0.75rem; }
    .border { border-width: 1px; }
    .border-2 { border-width: 2px; }
    .border-b { border-bottom-width: 1px; }
    .border-b-2 { border-bottom-width: 2px; }
    .border-t { border-top-width: 1px; }
    .border-l-4 { border-left-width: 4px; }
    .border-r { border-right-width: 1px; }
    .border-gray-100 { border-color: #f3f4f6; }
    .border-gray-200 { border-color: #e5e7eb; }
    .border-gray-300 { border-color: #d1d5db; }
    .border-purple-200 { border-color: #e9d5ff; }
    .border-purple-400 { border-color: #c084fc; }
    .border-purple-500 { border-color: #a855f7; }
    .border-yellow-200 { border-color: #fef08a; }
    .border-yellow-300 { border-color: #fde047; }
    .border-yellow-400 { border-color: #facc15; }
    .border-yellow-500 { border-color: #eab308; }
    .border-blue-200 { border-color: #bfdbfe; }
    .border-green-200 { border-color: #bbf7d0; }
    .border-green-300 { border-color: #86efac; }
    .border-red-200 { border-color: #fecaca; }
    .border-red-300 { border-color: #fca5a5; }
    .border-orange-200 { border-color: #fed7aa; }
    .border-pink-200 { border-color: #fbcfe8; }
    .border-amber-200 { border-color: #fde68a; }
    .border-transparent { border-color: transparent; }
    .border-dashed { border-style: dashed; }
    .shadow { box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px -1px rgba(0,0,0,0.1); }
    .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); }
    .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1); }
    .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1); }
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
    .opacity-0 { opacity: 0; }
    .opacity-50 { opacity: 0.5; }
    .opacity-60 { opacity: 0.6; }
    .opacity-70 { opacity: 0.7; }
    .opacity-75 { opacity: 0.75; }
    .opacity-80 { opacity: 0.8; }
    .opacity-90 { opacity: 0.9; }
    .opacity-100 { opacity: 1; }
    .cursor-pointer { cursor: pointer; }
    .cursor-not-allowed { cursor: not-allowed; }
    .select-none { user-select: none; }
    .overflow-hidden { overflow: hidden; }
    .overflow-x-auto { overflow-x: auto; }
    .overflow-y-auto { overflow-y: auto; }
    .overflow-x-hidden { overflow-x: hidden; }
    .grid { display: grid; }
    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
    .grid-cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
    .grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
    .col-span-2 { grid-column: span 2 / span 2; }
    .col-span-3 { grid-column: span 3 / span 3; }
    .hidden { display: none; }
    .block { display: block; }
    .inline { display: inline; }
    .inline-block { display: inline-block; }
    .inline-flex { display: inline-flex; }
    .table { display: table; }
    .relative { position: relative; }
    .absolute { position: absolute; }
    .fixed { position: fixed; }
    .sticky { position: sticky; }
    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
    .top-0 { top: 0; }
    .top-2 { top: 0.5rem; }
    .top-4 { top: 1rem; }
    .right-0 { right: 0; }
    .right-2 { right: 0.5rem; }
    .right-4 { right: 1rem; }
    .bottom-0 { bottom: 0; }
    .bottom-4 { bottom: 1rem; }
    .left-0 { left: 0; }
    .z-10 { z-index: 10; }
    .z-20 { z-index: 20; }
    .z-30 { z-index: 30; }
    .z-40 { z-index: 40; }
    .z-50 { z-index: 50; }
    .transition { transition-property: all; transition-timing-function: cubic-bezier(0.4,0,0.2,1); transition-duration: 150ms; }
    .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4,0,0.2,1); transition-duration: 150ms; }
    .transition-colors { transition-property: color,background-color,border-color; transition-timing-function: cubic-bezier(0.4,0,0.2,1); transition-duration: 150ms; }
    .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4,0,0.2,1); transition-duration: 150ms; }
    .duration-200 { transition-duration: 200ms; }
    .duration-300 { transition-duration: 300ms; }
    .ease-in-out { transition-timing-function: cubic-bezier(0.4,0,0.2,1); }
    .transform { transform: var(--tw-transform); }
    .scale-100 { transform: scale(1); }
    .scale-105 { transform: scale(1.05); }
    .hover\:bg-gray-50:hover { background-color: #f9fafb; }
    .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
    .hover\:bg-gray-200:hover { background-color: #e5e7eb; }
    .hover\:bg-gray-300:hover { background-color: #d1d5db; }
    .hover\:bg-gray-600:hover { background-color: #4b5563; }
    .hover\:bg-gray-700:hover { background-color: #374151; }
    .hover\:bg-blue-50:hover { background-color: #eff6ff; }
    .hover\:bg-blue-100:hover { background-color: #dbeafe; }
    .hover\:bg-blue-600:hover { background-color: #2563eb; }
    .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
    .hover\:bg-red-50:hover { background-color: #fef2f2; }
    .hover\:bg-red-100:hover { background-color: #fee2e2; }
    .hover\:bg-red-600:hover { background-color: #dc2626; }
    .hover\:bg-red-700:hover { background-color: #b91c1c; }
    .hover\:bg-green-100:hover { background-color: #dcfce7; }
    .hover\:bg-green-200:hover { background-color: #bbf7d0; }
    .hover\:bg-green-600:hover { background-color: #16a34a; }
    .hover\:bg-green-700:hover { background-color: #15803d; }
    .hover\:bg-yellow-50:hover { background-color: #fefce8; }
    .hover\:bg-yellow-100:hover { background-color: #fef9c3; }
    .hover\:bg-yellow-600:hover { background-color: #ca8a04; }
    .hover\:bg-yellow-700:hover { background-color: #a16207; }
    .hover\:bg-orange-50:hover { background-color: #fff7ed; }
    .hover\:bg-orange-600:hover { background-color: #ea580c; }
    .hover\:bg-purple-50:hover { background-color: #faf5ff; }
    .hover\:bg-purple-100:hover { background-color: #f3e8ff; }
    .hover\:bg-purple-200:hover { background-color: #e9d5ff; }
    .hover\:bg-purple-600:hover { background-color: #9333ea; }
    .hover\:bg-purple-700:hover { background-color: #7e22ce; }
    .hover\:bg-pink-50:hover { background-color: #fdf2f8; }
    .hover\:bg-pink-600:hover { background-color: #db2777; }
    .hover\:bg-amber-50:hover { background-color: #fffbeb; }
    .hover\:bg-amber-100:hover { background-color: #fef3c7; }
    .hover\:bg-amber-600:hover { background-color: #d97706; }
    .hover\:bg-teal-700:hover { background-color: #0f766e; }
    .hover\:bg-white:hover { background-color: white; }
    .hover\:bg-opacity-30:hover { --tw-bg-opacity: 0.3; }
    .hover\:bg-opacity-90:hover { --tw-bg-opacity: 0.9; }
    .hover\:text-white:hover { color: white; }
    .hover\:text-gray-200:hover { color: #e5e7eb; }
    .hover\:text-gray-600:hover { color: #4b5563; }
    .hover\:text-gray-700:hover { color: #374151; }
    .hover\:text-gray-800:hover { color: #1f2937; }
    .hover\:text-blue-500:hover { color: #3b82f6; }
    .hover\:text-blue-800:hover { color: #1e40af; }
    .hover\:text-red-500:hover { color: #ef4444; }
    .hover\:text-red-700:hover { color: #b91c1c; }
    .hover\:text-purple-600:hover { color: #9333ea; }
    .hover\:text-purple-800:hover { color: #6b21a8; }
    .hover\:underline:hover { text-decoration: underline; }
    .hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .hover\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    .hover\:shadow-xl:hover { box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    .hover\:shadow-2xl:hover { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
    .hover\:-translate-y-1:hover { transform: translateY(-0.25rem); }
    .hover\:border-gray-300:hover { border-color: #d1d5db; }
    .hover\:border-yellow-300:hover { border-color: #fde047; }
    .hover\:border-yellow-400:hover { border-color: #facc15; }
    .hover\:opacity-90:hover { opacity: 0.9; }
    .focus\:outline-none:focus { outline: none; }
    .focus\:ring-0:focus { box-shadow: none; }
    .focus\:ring-2:focus { box-shadow: 0 0 0 2px var(--tw-ring-color, rgba(59,130,246,0.5)); }
    .focus\:ring-yellow-200:focus { --tw-ring-color: #fef08a; }
    .focus\:border-amber-400:focus { border-color: #fbbf24; }
    .focus\:border-orange-500:focus { border-color: #f97316; }
    .focus\:border-pink-400:focus { border-color: #f472b6; }
    .focus\:border-purple-400:focus { border-color: #c084fc; }
    .focus\:border-purple-500:focus { border-color: #a855f7; }
    .focus\:border-yellow-400:focus { border-color: #facc15; }
    .focus\:border-yellow-500:focus { border-color: #eab308; }
    .space-y-1 > * + * { margin-top: 0.25rem; }
    .space-y-2 > * + * { margin-top: 0.5rem; }
    .space-y-3 > * + * { margin-top: 0.75rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }
    .space-x-1 > * + * { margin-left: 0.25rem; }
    .space-x-2 > * + * { margin-left: 0.5rem; }
    .space-x-3 > * + * { margin-left: 0.75rem; }
    .space-x-4 > * + * { margin-left: 1rem; }
    .ring-1 { box-shadow: 0 0 0 1px var(--tw-ring-color, rgba(0,0,0,0.05)); }
    .ring-2 { box-shadow: 0 0 0 2px var(--tw-ring-color, rgba(0,0,0,0.05)); }
    .ring-purple-200 { --tw-ring-color: #e9d5ff; }
    .ring-yellow-200 { --tw-ring-color: #fef08a; }
    .appearance-none { appearance: none; }
    .pointer-events-none { pointer-events: none; }
    .resize-none { resize: none; }
    .object-cover { object-fit: cover; }
    .object-contain { object-fit: contain; }
    .underline { text-decoration: underline; }
    .no-underline { text-decoration: none; }
    .line-through { text-decoration: line-through; }
    .list-disc { list-style-type: disc; }
    .list-none { list-style-type: none; }
    .outline-none { outline: none; }
    .animate-spin { animation: spin 1s linear infinite; }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4,0,0.6,1) infinite; }
    .animate-bounce { animation: bounce 1s infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0,0,0.2,1); } }
    @media (min-width: 640px) {
      .sm\:block { display: block; }
      .sm\:inline { display: inline; }
    }
    @media (min-width: 768px) {
      .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
      .md\:grid-cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
      .md\:flex-row { flex-direction: row; }
      .md\:flex-col { flex-direction: column; }
      .md\:items-center { align-items: center; }
      .md\:justify-between { justify-content: space-between; }
      .md\:col-span-2 { grid-column: span 2 / span 2; }
      .md\:col-span-3 { grid-column: span 3 / span 3; }
      .md\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
      .md\:w-auto { width: auto; }
      .md\:ml-8 { margin-left: 2rem; }
      .md\:mt-0 { margin-top: 0; }
      .md\:left-auto { left: auto; }
      .md\:right-4 { right: 1rem; }
    }
    @media (min-width: 1024px) {
      .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .lg\:grid-cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
      .lg\:grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
    }
  </style>

  
  
  
  
  
  <style>
    /* ‚úÖ PERFORMANCE: GPU acceleration for smooth animations */
    .avanti-gradient, .stat-card, .chapter-card, .modal-content {
      transform: translateZ(0);
      backface-visibility: hidden;
    }
    
    /* ‚úÖ PERFORMANCE: Reduce paint areas */
    #root {
  min-height: 100vh;
}
    
    /* Priority Badge Gradients */
.priority-badge {
  display: inline-block;
  padding: 0.4rem 0.8rem;
  border-radius: 0.4rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: white;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
  text-align: center;
  min-width: 100px;
  letter-spacing: 0.02em;
}

.priority-high {
  background: linear-gradient(90deg, #10B981 0%, #34D399 100%);
}

.priority-medium {
  background: linear-gradient(90deg, #F59E0B 0%, #FBBF24 100%);
}

.priority-low {
  background: linear-gradient(90deg, #EF4444 0%, #F87171 100%);
}
    :root{
      --avanti-yellow:#F4B41A;
      --avanti-orange:#E8B039;
      --avanti-red:#C8342E;
      /* Light theme (default) */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
    }
    
    /* Dark Theme */
    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border-color: #334155;
    }
    
    [data-theme="dark"] .main-content {
      background: var(--bg-primary) !important;
    }
    
    [data-theme="dark"] .bg-white {
      background: var(--bg-card) !important;
    }
    
    [data-theme="dark"] .bg-gray-50,
    [data-theme="dark"] .bg-gray-100 {
      background: var(--bg-secondary) !important;
    }
    
    [data-theme="dark"] .text-gray-900,
    [data-theme="dark"] .text-gray-800,
    [data-theme="dark"] .text-gray-700 {
      color: var(--text-primary) !important;
    }
    
    [data-theme="dark"] .text-gray-600,
    [data-theme="dark"] .text-gray-500 {
      color: var(--text-secondary) !important;
    }
    
    [data-theme="dark"] .border-gray-200,
    [data-theme="dark"] .border-gray-300 {
      border-color: var(--border-color) !important;
    }
    
    [data-theme="dark"] .shadow-lg,
    [data-theme="dark"] .shadow-md,
    [data-theme="dark"] .shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
    }
    
    [data-theme="dark"] input,
    [data-theme="dark"] select,
    [data-theme="dark"] textarea {
      background: var(--bg-secondary) !important;
      color: var(--text-primary) !important;
      border-color: var(--border-color) !important;
    }
    
    [data-theme="dark"] table {
      background: var(--bg-card);
    }
    
    [data-theme="dark"] th {
      background: var(--bg-secondary) !important;
      color: var(--text-primary) !important;
    }
    
    [data-theme="dark"] td {
      border-color: var(--border-color) !important;
      color: var(--text-primary) !important;
    }
    
    [data-theme="dark"] tr:hover {
      background: rgba(255,255,255,0.05) !important;
    }
    
    /* ‚úÖ FIX: Dark mode Social Wall text visibility */
    [data-theme="dark"] .post-card {
      background: var(--bg-card) !important;
      border-color: var(--border-color) !important;
    }
    
    [data-theme="dark"] .post-card .text-gray-700,
    [data-theme="dark"] .post-card .text-gray-800,
    [data-theme="dark"] .post-card p {
      color: #e2e8f0 !important;
    }
    
    [data-theme="dark"] .post-card .text-gray-500,
    [data-theme="dark"] .post-card .text-gray-400 {
      color: #94a3b8 !important;
    }
    
    [data-theme="dark"] .post-card .bg-gray-50,
    [data-theme="dark"] .post-card .bg-gray-100 {
      background: #334155 !important;
    }
    
    [data-theme="dark"] .reddit-action-row .reddit-timestamp,
    [data-theme="dark"] .reddit-action-row .reddit-action-btn {
      color: #94a3b8 !important;
    }
    
    [data-theme="dark"] .reddit-action-row .reddit-action-btn:hover {
      background: rgba(255,255,255,0.1) !important;
      color: #e2e8f0 !important;
    }
    
    [data-theme="dark"] .emoji-btn {
      background: #334155 !important;
    }
    
    [data-theme="dark"] .emoji-btn:hover {
      background: #475569 !important;
    }
    
    [data-theme="dark"] .mention-tag {
      color: #60a5fa !important;
      background: rgba(96, 165, 250, 0.15) !important;
    }
    
    [data-theme="dark"] .tab-inactive {
      background: var(--bg-card) !important;
      color: #94a3b8 !important;
    }
    
    [data-theme="dark"] .celebration-card {
      background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%) !important;
      border-color: #6366f1 !important;
    }
    
    [data-theme="dark"] .celebration-card h3 {
      color: #f9a8d4 !important;
    }
    
    /* ‚úÖ FIX: Profile photo in comments - remove vertical line */
    .comment-wrapper img,
    .comment-wrapper > div:first-child {
      border: none !important;
      box-shadow: none !important;
      position: relative;
      z-index: 2;
    }
    
    /* ‚úÖ FIX: Ensure thread line doesn't overlap avatar */
    .reddit-comment-thread::before {
      left: 12px;
      z-index: 1;
    }
    
    /* Theme Toggle Switch */
    .theme-toggle-container {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      margin: 8px;
    }
    
    .theme-toggle {
      position: relative;
      width: 50px;
      height: 26px;
      background: #374151;
      border-radius: 13px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .theme-toggle.dark {
      background: #F4B41A;
    }
    
    .theme-toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .theme-toggle.dark .theme-toggle-slider {
      transform: translateX(24px);
    }
    
    *{box-sizing:border-box}
    
    /* Smooth scrolling for the entire app */
    html {
      scroll-behavior: smooth;
    }
    
    /* Better font rendering */
    body {
  margin: 0;
  overflow-x: hidden;

  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

    
    /* Enhanced Mobile Sidebar Styles */
    .mobile-sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 998;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .mobile-sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .mobile-sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 280px;
      max-width: 85vw;
      background: white;
      z-index: 999;
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 2px 0 12px rgba(0, 0, 0, 0.15);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .mobile-sidebar.active {
      transform: translateX(0);
    }
    
    /* Desktop sidebar adjustments */
    @media (min-width: 768px) {
      .mobile-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        transform: translateX(0) !important;
        max-width: none;
        box-shadow: none;
      }
      
      /* Width is controlled by .sidebar.collapsed/expanded classes */
      
      .mobile-sidebar-overlay {
        display: none;
      }
    }
    
    /* Responsive card improvements */
    @media (max-width: 768px) {
      .stat-card {
        padding: 1rem;
        margin-bottom: 0.75rem;
      }
      
      .chapter-card {
        padding: 1rem;
        margin-bottom: 0.75rem;
      }
      
      .modal-content {
        width: 95%;
        padding: 1.25rem;
        margin: 10px;
      }
      
      .ranking-card {
        padding: 1rem;
        margin-bottom: 0.75rem;
      }
      
      /* Better table responsiveness */
      table {
        font-size: 0.875rem;
      }
      
      th, td {
        padding: 0.5rem !important;
      }
    }
    
    /* Touch-friendly buttons */
    button, .button {
      min-height: 44px;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Mobile Performance Optimizations */
    @media (max-width: 768px) {
      /* Hardware acceleration for smooth scrolling */
      .mobile-sidebar, .chapter-card, .stat-card {
        will-change: transform;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
      }
      
      /* Reduce animations on mobile for smoother experience */
      .chapter-card {
        transition: box-shadow 0.2s ease !important;
      }
      
      .chapter-card:hover {
        transform: none !important;
      }
      
      /* Optimize scroll performance */
      body {
        -webkit-overflow-scrolling: touch;
        overflow-scrolling: touch;
      }
      
      /* Prevent layout shifts */
      img, svg {
        max-width: 100%;
        height: auto;
      }
      
      /* Faster tap response */
      a, button, input, select, textarea {
        touch-action: manipulation;
      }
    }
    
    /* Reduce motion for users who prefer it */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* Better spacing for mobile */
    @media (max-width: 768px) {
      .p-6 {
        padding: 1rem !important;
      }
      
      .p-8 {
        padding: 1.5rem !important;
      }
      
      .gap-6 {
        gap: 1rem !important;
      }
      
      .space-y-6 > * + * {
        margin-top: 1rem !important;
      }
      
      /* Responsive grid adjustments */
      .grid-cols-2, .grid-cols-3, .grid-cols-4 {
        grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
      }
      
      .md\:grid-cols-2, .md\:grid-cols-3 {
        grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
      }
    }
    
    /* Small screens - 2 columns for some grids */
    @media (min-width: 480px) and (max-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
      }
    }
    @keyframes confetti-fall{0%{transform:translateY(-100vh) rotate(0) scale(1);opacity:1}100%{transform:translateY(100vh) rotate(720deg) scale(.5);opacity:0}}
    @keyframes spin{to{transform:rotate(360deg)}}
    .confetti-piece{position:fixed;pointer-events:none;z-index:9999;animation:confetti-fall 4s cubic-bezier(.25,.46,.45,.94) forwards}
    .chapter-card{transition:all .3s ease;position:relative;overflow:hidden}
    .chapter-card h3{word-break:break-word;overflow-wrap:break-word}
    .break-words{word-break:break-word;overflow-wrap:break-word}
    .chapter-card:hover{transform:translateY(-4px);box-shadow:0 20px 40px -12px rgba(0,0,0,.2)}
    .chapter-card.completed{background:linear-gradient(135deg,#d1fae5,#a7f3d0);border:3px solid #10b981}
    .chapter-card.delayed{background:linear-gradient(135deg,#fed7aa,#fdba74);border:3px solid #f97316}
    .chapter-card.pending{background:linear-gradient(135deg,#fecaca,#fca5a5);border:3px solid #ef4444}
    input:focus,select:focus,textarea:focus{outline:none;box-shadow:0 0 0 4px rgba(244,180,26,.2);border-color:var(--avanti-yellow)}
    .avanti-gradient{background:linear-gradient(135deg,var(--avanti-yellow) 0%,var(--avanti-orange) 50%,var(--avanti-red) 100%) !important}
    .avanti-gradient-light{background:linear-gradient(135deg,rgba(244,180,26,.1) 0%,rgba(232,176,57,.1) 50%,rgba(200,52,46,.1) 100%)}
    .stat-card{border-radius:1rem;padding:1.5rem;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);transition:all .3s}
    /* ‚úÖ FIX: Only apply white background when no gradient class is present */
    .stat-card:not(.avanti-gradient):not([class*="bg-"]):not([class*="from-"]) {
      background: white;
    }
    .stat-card:hover{transform:translateY(-4px);box-shadow:0 10px 15px -3px rgba(0,0,0,.1)}
    input[type="checkbox"]{appearance:none;width:20px;height:20px;border:2px solid var(--avanti-red);border-radius:4px;cursor:pointer;position:relative;flex-shrink:0}
    input[type="checkbox"]:checked{background:var(--avanti-red)}
    input[type="checkbox"]:checked::after{content:'‚úì';position:absolute;color:white;font-size:14px;top:50%;left:50%;transform:translate(-50%,-50%)}
    .birthday-card{background:linear-gradient(135deg,#FFD700,#FFA500);border:3px solid #FF6347;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    
    /* Floating Celebration Card */
    .floating-celebration-card {
      position: fixed;
      top: 80px;
      right: 20px;
      width: 320px;
      max-width: calc(100vw - 40px);
      background: linear-gradient(135deg, #FF6B9D 0%, #C44B6C 50%, #8B2A4D 100%);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 40px rgba(196, 75, 108, 0.4);
      z-index: 9990;
      animation: slideInRight 0.5s ease-out, celebrationGlow 2s ease-in-out infinite;
      color: white;
    }
    .floating-celebration-card.anniversary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #6B4D9E 100%);
      box-shadow: 0 10px 40px rgba(118, 75, 162, 0.4);
    }
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes celebrationGlow {
      0%, 100% { box-shadow: 0 10px 40px rgba(196, 75, 108, 0.4); }
      50% { box-shadow: 0 10px 50px rgba(196, 75, 108, 0.6), 0 0 60px rgba(255, 107, 157, 0.3); }
    }
    .floating-celebration-card .close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255,255,255,0.25);
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      min-width: 32px;
      min-height: 32px;
      cursor: pointer !important;
      color: white;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      pointer-events: auto !important;
      z-index: 10000 !important;
      touch-action: manipulation;
      -webkit-tap-highlight-color: rgba(255,255,255,0.3);
    }
    .floating-celebration-card .close-btn:hover {
      background: rgba(255,255,255,0.3);
    }
    .floating-celebration-card .celebration-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .floating-celebration-card .avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      flex-shrink: 0;
      border: 3px solid rgba(255,255,255,0.3);
      overflow: hidden;
    }
    .floating-celebration-card .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .floating-celebration-card .info h4 {
      font-size: 14px;
      font-weight: 600;
      margin: 0;
      opacity: 0.9;
    }
    .floating-celebration-card .info h3 {
      font-size: 18px;
      font-weight: 700;
      margin: 4px 0;
    }
    .floating-celebration-card .info p {
      font-size: 12px;
      margin: 0;
      opacity: 0.8;
    }
    .floating-celebration-card .confetti {
      position: absolute;
      font-size: 20px;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(10deg); }
    }
    @media (max-width: 640px) {
      .floating-celebration-card {
        top: auto;
        bottom: 80px;
        right: 10px;
        left: 10px;
        width: auto;
      }
    }
    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:9998}
    .modal-content{background:white;border-radius:1rem;padding:2rem;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}
    .status-badge{padding:.5rem 1rem;border-radius:.5rem;font-weight:bold;text-align:center;font-size:.875rem}
    .status-ahead{background:#10b981;color:white}
    .status-ontrack{background:#3b82f6;color:white}
    .status-delayed{background:#f97316;color:white}
    .ranking-card{background:white;border-radius:1rem;padding:1.5rem;box-shadow:0 4px 6px rgba(0,0,0,.1)}
    .ranking-1{border-left:4px solid #fbbf24}
    .ranking-2{border-left:4px solid #c0c0c0}
    .ranking-3{border-left:4px solid #cd7f32}
    .chapter-details{position:relative;z-index:10;pointer-events:auto!important}
.chapter-details input,.chapter-details select,.chapter-details textarea,.chapter-details button,.chapter-details label{position:relative;z-index:20;pointer-events:auto!important;cursor:pointer}
.chapter-details input[type="checkbox"]{cursor:pointer}
.chapter-details select{cursor:pointer;background-color:white}
.chapter-details input[type="date"]{cursor:pointer;background-color:white}

/* Teacher Feedback Styles */
.star-rating {
  display: inline-flex;
  gap: 8px;
  font-size: 32px;
  cursor: pointer;
}
.star {
  color: #d1d5db;
  transition: color 0.2s;
  cursor: pointer;
}
.star.filled {
  color: #F4B41A;
}
.star:hover, .star.hover {
  color: #E8B039;
}
.feedback-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  overflow-y: auto;
}
.feedback-content {
  background: white;
  border-radius: 1rem;
  max-width: 600px;
  width: 95%;
  max-height: 90vh;
  overflow-y: auto;
  margin: 20px;
}
.rating-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: bold;
}
.rating-excellent {
  background: #10b981;
  color: white;
}
.rating-good {
  background: #3b82f6;
  color: white;
}
.rating-average {
  background: #f59e0b;
  color: white;
}
.rating-poor {
  background: #ef4444;
  color: white;
}
.teacher-card {
  transition: all 0.3s ease;
  cursor: pointer;
}
.teacher-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}
.feedback-notification {
  position: fixed;
  top: 80px;
  right: 20px;
  background: linear-gradient(135deg, #F4B41A, #E8B039);
  color: white;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  z-index: 9999;
  animation: slideIn 0.5s ease;
}
@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

/* ========================================
   MODERN SIDEBAR STYLES - Fixed & Scrollable
   ======================================== */
.sidebar {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  height: 100vh !important;
  height: 100dvh !important;
  background: #1a1a2e;
  box-shadow: 4px 0 15px rgba(0,0,0,0.15);
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1000 !important;
  overflow-x: hidden;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

/* Custom scrollbar for sidebar */
.sidebar::-webkit-scrollbar {
  width: 6px;
}
.sidebar::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
}
.sidebar::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.2);
  border-radius: 3px;
}
.sidebar::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.3);
}

.sidebar.collapsed {
  width: 72px;
}

.sidebar.expanded {
  width: 260px;
}

/* ========================================
   MOBILE FIXED HEADER WITH HAMBURGER
   ======================================== */
.mobile-fixed-header {
  display: none;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  height: 56px;
  background: #1a1a2e;
  z-index: 1001 !important;
  padding: 0 16px;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

@media (max-width: 768px) {
  .mobile-fixed-header {
    display: flex !important;
  }
}

.mobile-hamburger {
  width: 44px;
  height: 44px;
  background: linear-gradient(135deg, #F4B41A 0%, #E8B039 100%);
  border: none;
  border-radius: 10px;
  color: white;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mobile-header-title {
  color: white;
  font-weight: 600;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.mobile-header-logo {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #F4B41A 0%, #E8B039 100%);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

/* ========================================
   MOBILE BOTTOM NAVIGATION - Always Visible
   ======================================== */
.mobile-bottom-nav {
  display: none;
  position: fixed !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  height: 65px;
  background: #1a1a2e;
  z-index: 1001 !important;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
  padding: 0 8px;
  padding-bottom: env(safe-area-inset-bottom, 0px);
  border-top: 1px solid rgba(255,255,255,0.1);
  align-items: center;
  justify-content: space-around;
}

@media (max-width: 768px) {
  .mobile-bottom-nav {
    display: flex !important;
  }
}

.mobile-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px 10px;
  color: rgba(255,255,255,0.5);
  cursor: pointer;
  transition: all 0.2s ease;
  border-radius: 10px;
  min-width: 55px;
  text-decoration: none;
  background: none;
  border: none;
  font-family: inherit;
}

.mobile-nav-item:hover,
.mobile-nav-item:active {
  color: rgba(255,255,255,0.8);
  background: rgba(255,255,255,0.05);
}

.mobile-nav-item.active {
  color: #F4B41A;
  background: rgba(244, 180, 26, 0.15);
}

.mobile-nav-icon {
  font-size: 1.3rem;
  margin-bottom: 2px;
}

.mobile-nav-label {
  font-size: 0.6rem;
  font-weight: 500;
  white-space: nowrap;
}

/* More menu popup */
.mobile-more-menu {
  position: fixed !important;
  bottom: 75px !important;
  right: 10px !important;
  background: #1a1a2e;
  border-radius: 16px;
  box-shadow: 0 -8px 30px rgba(0,0,0,0.4);
  padding: 12px;
  min-width: 220px;
  max-height: 60vh;
  overflow-y: auto;
  z-index: 1002 !important;
  border: 1px solid rgba(255,255,255,0.1);
  transform: translateY(20px);
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.mobile-more-menu.open {
  transform: translateY(0);
  opacity: 1;
  visibility: visible;
}

.mobile-more-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  color: rgba(255,255,255,0.8);
  cursor: pointer;
  border-radius: 10px;
  transition: all 0.2s;
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  font-family: inherit;
  font-size: 14px;
}

.mobile-more-item:hover {
  background: rgba(255,255,255,0.08);
  color: white;
}

.mobile-more-item.active {
  background: rgba(244, 180, 26, 0.2);
  color: #F4B41A;
}

.mobile-more-item-icon {
  font-size: 1.1rem;
  width: 24px;
  text-align: center;
}

.mobile-more-overlay {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 65px !important;
  background: rgba(0,0,0,0.4);
  z-index: 1001 !important;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.mobile-more-overlay.open {
  opacity: 1;
  visibility: visible;
}

/* ========================================
   FLOATING TOGGLE BUTTON - HIDDEN (User Request)
   ======================================== */
.sidebar-float-toggle {
  display: none !important;
}

/* ========================================
   INSTALL APP BANNER - Top of Page
   ======================================== */
.install-app-banner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 10px 20px;
  background: #1a1a2e;
  color: white;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1005;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  font-size: 14px;
  font-weight: 500;
}

.install-app-banner.hidden {
  display: none !important;
}

.install-app-banner-text {
  display: flex;
  align-items: center;
  gap: 8px;
}

.install-app-banner-text i {
  font-size: 18px;
  color: #F4B41A;
}

.install-app-banner-btn {
  background: linear-gradient(135deg, #F4B41A 0%, #E8B039 100%);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.install-app-banner-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(244, 180, 26, 0.4);
}

.install-app-banner-close {
  background: rgba(255,255,255,0.1);
  border: none;
  color: rgba(255,255,255,0.7);
  width: 32px;
  height: 32px;
  min-width: 32px;
  min-height: 32px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  margin-left: 8px;
  transition: all 0.2s;
  pointer-events: auto !important;
  position: relative;
  z-index: 10;
  -webkit-tap-highlight-color: rgba(255,255,255,0.2);
}

.install-app-banner-close:hover {
  background: rgba(255,255,255,0.2);
  color: white;
  transform: scale(1.1);
}

.install-app-banner-close:active {
  transform: scale(0.95);
}

/* Adjust page layout when banner is visible */
body.has-install-banner .mobile-fixed-header {
  top: 44px !important;
}

body.has-install-banner .main-content {
  padding-top: 114px !important;
}

body.has-install-banner .sidebar {
  top: 44px !important;
  height: calc(100vh - 44px) !important;
  height: calc(100dvh - 44px) !important;
}

@media (max-width: 768px) {
  .install-app-banner {
    padding: 8px 12px;
    font-size: 12px;
    gap: 8px;
  }
  
  .install-app-banner-btn {
    padding: 6px 12px;
    font-size: 12px;
  }
  
  .install-app-banner-text span {
    display: none;
  }
  
  body.has-install-banner .main-content.sidebar-expanded,
  body.has-install-banner .main-content.sidebar-collapsed {
    padding-top: 114px !important;
  }
}

/* ========================================
   HOVER-TO-OPEN SIDEBAR (Desktop Only)
   ======================================== */
@media (min-width: 769px) {
  /* Hover detection zone */
  .sidebar-hover-zone {
    position: fixed;
    top: 0;
    left: 0;
    width: 20px;
    height: 100vh;
    z-index: 999;
    background: transparent;
  }
  
  /* When sidebar is collapsed, expand on hover */
  .sidebar.collapsed.hovering {
    width: 260px !important;
  }
  
  .sidebar.collapsed.hovering .sidebar-label {
    opacity: 1 !important;
    width: auto !important;
    display: inline !important;
  }
  
  .sidebar.collapsed.hovering .sidebar-logo-text {
    opacity: 1 !important;
    width: auto !important;
  }
  
  .sidebar.collapsed.hovering .sidebar-item {
    justify-content: flex-start !important;
    padding: 0.75rem 1rem !important;
  }
  
  .sidebar.collapsed.hovering .sidebar-item.active::before {
    display: block !important;
  }
  
  .sidebar.collapsed.hovering .sidebar-logout span {
    display: inline !important;
  }
  
  .sidebar.collapsed.hovering .theme-toggle-container {
    display: flex !important;
  }
  
  /* Hide collapsed dark mode toggle when hovering */
  .sidebar.collapsed.hovering > .sidebar-footer > .sidebar-item[data-tooltip] {
    display: none !important;
  }
}

.sidebar-header {
  padding: 1.25rem;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  display: flex;
  align-items: center;
  justify-content: space-between;
  min-height: 70px;
  background: rgba(244, 180, 26, 0.1);
  position: sticky;
  top: 0;
  z-index: 10;
}

.sidebar-logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.sidebar-logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #F4B41A 0%, #E8B039 100%);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.sidebar-logo-text {
  color: white;
  font-weight: 700;
  font-size: 1rem;
  white-space: nowrap;
  overflow: hidden;
  transition: opacity 0.2s, width 0.2s;
}

.sidebar.collapsed .sidebar-logo-text {
  opacity: 0;
  width: 0;
}

.sidebar-toggle {
  background: rgba(255,255,255,0.08);
  border: none;
  color: rgba(255,255,255,0.7);
  width: 32px;
  height: 32px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
}

.sidebar-toggle:hover {
  background: rgba(244, 180, 26, 0.3);
  color: #F4B41A;
}

.sidebar-nav {
  padding: 1rem 0.75rem;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.sidebar-item {
  display: flex;
  align-items: center;
  padding: 0.75rem 1rem;
  color: rgba(255,255,255,0.65);
  cursor: pointer;
  transition: all 0.2s ease;
  border-radius: 10px;
  gap: 12px;
  text-decoration: none;
  position: relative;
  margin: 0 4px;
}

.sidebar-item:hover {
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.9);
}

.sidebar-item.active {
  background: linear-gradient(135deg, rgba(244, 180, 26, 0.2) 0%, rgba(232, 176, 57, 0.15) 100%);
  color: #F4B41A;
  font-weight: 600;
}

.sidebar-item.active::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 3px;
  height: 60%;
  background: #F4B41A;
  border-radius: 0 3px 3px 0;
}

.sidebar-icon {
  font-size: 1.2rem;
  min-width: 24px;
  text-align: center;
  transition: transform 0.2s;
}

.sidebar-item:hover .sidebar-icon {
  transform: scale(1.1);
}

.sidebar-label {
  white-space: nowrap;
  overflow: hidden;
  font-size: 0.9rem;
  transition: opacity 0.2s, width 0.2s;
}

.sidebar.collapsed .sidebar-label {
  opacity: 0;
  width: 0;
  display: none;
}

.sidebar.collapsed .sidebar-item {
  justify-content: center;
  padding: 0.85rem;
}

.sidebar.collapsed .sidebar-item.active::before {
  display: none;
}

/* Sidebar footer */
.sidebar-footer {
  padding: 1rem;
  border-top: 1px solid rgba(255,255,255,0.08);
  margin-top: auto;
}

.sidebar-logout {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 0.85rem 1rem;
  min-height: 52px;
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
  border: 2px solid rgba(239, 68, 68, 0.3);
  border-radius: 10px;
  cursor: pointer !important;
  font-size: 0.95rem;
  font-weight: 600;
  transition: all 0.2s;
  pointer-events: auto !important;
  position: relative;
  z-index: 1000 !important;
  -webkit-tap-highlight-color: rgba(239, 68, 68, 0.3);
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
}

.sidebar-logout:hover {
  background: rgba(239, 68, 68, 0.25);
  color: #fca5a5;
}

.sidebar-logout:active {
  background: rgba(239, 68, 68, 0.35);
  transform: scale(0.98);
}

.sidebar.collapsed .sidebar-logout span {
  display: none;
}

/* Mobile hamburger */
.mobile-header {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: #1a1a2e;
  z-index: 999;
  padding: 0 1rem;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.hamburger-btn {
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: background 0.2s;
}

.hamburger-btn:hover {
  background: rgba(255,255,255,0.1);
}

.mobile-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  color: white;
  font-weight: 600;
}

/* Main content adjustments */
.main-content {
  min-height: 100vh;
  background: #f8fafc;
  transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.main-content.sidebar-expanded {
  margin-left: 260px;
}

.main-content.sidebar-collapsed {
  margin-left: 72px;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .mobile-header {
    display: none; /* Hide old mobile header */
  }
  
  .sidebar {
    transform: translateX(-100%);
    width: 280px !important;
  }
  
  .sidebar.mobile-open {
    transform: translateX(0) !important;
  }
  
  .sidebar-toggle {
    display: none;
  }
  
  .main-content.sidebar-expanded,
  .main-content.sidebar-collapsed {
    margin-left: 0 !important;
    padding-top: 70px; /* Space for mobile header */
    padding-bottom: 85px; /* ‚úÖ FIX: Increased space for bottom nav */
    width: 100%;
    min-height: 100vh;
    min-height: 100dvh;
  }
  
  .mobile-sidebar-overlay.active {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 998;
  }
}

/* Tooltip for collapsed sidebar */
.sidebar.collapsed .sidebar-item {
  position: relative;
}

.sidebar.collapsed .sidebar-item::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  background: #1a1a2e;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 0.85rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s, left 0.2s;
  margin-left: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 1001;
}

.sidebar.collapsed .sidebar-item:hover::after {
  opacity: 1;
  left: calc(100% + 5px);
}

/* Scrollbar styling for sidebar */
.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.1);
}

.sidebar::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.3);
  border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.5);
}

/* ========================================
   ASSET MANAGEMENT STYLES
   ======================================== */
.barcode-scanner-container {
  position: relative;
  width: 100%;
  max-width: 400px;
  margin: 0 auto;
}

#barcode-reader {
  width: 100%;
  border-radius: 12px;
  overflow: hidden;
}

#barcode-reader video {
  border-radius: 12px;
}

.asset-card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border-left: 4px solid #F4B41A;
}

.asset-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.asset-card.book {
  border-left-color: #3B82F6;
}

.asset-card.chromebook {
  border-left-color: #10B981;
}

.asset-card.overdue {
  border-left-color: #EF4444;
  background: #FEF2F2;
}

.asset-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.badge-available {
  background: #D1FAE5;
  color: #059669;
}

.badge-assigned {
  background: #FEF3C7;
  color: #D97706;
}

.badge-overdue {
  background: #FEE2E2;
  color: #DC2626;
}

.badge-returned {
  background: #E0E7FF;
  color: #4F46E5;
}

.request-card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  border-left: 4px solid #F59E0B;
}

.request-card.pending {
  border-left-color: #F59E0B;
}

.request-card.approved {
  border-left-color: #10B981;
}

.request-card.rejected {
  border-left-color: #EF4444;
}

@media (max-width: 768px) {
  .barcode-scanner-container {
    max-width: 100%;
  }
}

/* ========================================
   ONLINE STATUS CARD STYLES
   ======================================== */
.online-status-card {
  position: fixed;
  top: 80px;
  right: 20px;
  background: linear-gradient(135deg, #1a1a24 0%, #12121a 100%);
  border: 1px solid #2a2a3a;
  border-radius: 16px;
  padding: 12px 16px;
  min-width: 180px;
  z-index: 9995;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  animation: slideInRight 0.3s ease;
  pointer-events: auto !important;
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.online-status-card .close-btn {
  position: absolute;
  top: 6px;
  right: 6px;
  background: rgba(255,255,255,0.15);
  border: none;
  color: #fff;
  cursor: pointer !important;
  font-size: 18px;
  font-weight: bold;
  padding: 0;
  width: 32px;
  height: 32px;
  min-width: 32px;
  min-height: 32px;
  border-radius: 50%;
  transition: all 0.2s;
  pointer-events: auto !important;
  z-index: 10000 !important;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-tap-highlight-color: rgba(255,255,255,0.3);
  touch-action: manipulation;
  line-height: 1;
  user-select: none;
  -webkit-user-select: none;
}

.online-status-card .close-btn:hover {
  background: rgba(255,255,255,0.2);
  color: #fff;
  transform: scale(1.1);
}

.online-status-card .close-btn:active {
  transform: scale(0.95);
}

.online-status-card .status-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}

.online-status-card .status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

.online-status-card .status-dot.online {
  background: #10b981;
  box-shadow: 0 0 8px #10b981;
}

.online-status-card .status-dot.offline {
  background: #6b7280;
  animation: none;
}

/* ========================================
   REACTION TOOLTIP STYLES
   ======================================== */
.reaction-btn-wrapper {
  position: relative;
  display: inline-block;
}

.reaction-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: #1a1a24;
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 12px;
  white-space: nowrap;
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  pointer-events: none;
}

.reaction-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: #1a1a24;
}

.reaction-btn-wrapper:hover .reaction-tooltip {
  opacity: 1;
  visibility: visible;
}

/* ========================================
   @MENTION STYLES
   ======================================== */
.mention-input-container {
  position: relative;
}

.mention-dropdown {
  position: absolute;
  bottom: 100%;
  left: 0;
  right: 0;
  max-height: 200px;
  overflow-y: auto;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  box-shadow: 0 -4px 16px rgba(0,0,0,0.1);
  z-index: 100;
  margin-bottom: 4px;
}

.mention-dropdown-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  cursor: pointer;
  border-bottom: 1px solid #f3f4f6;
  transition: background 0.2s;
}

.mention-dropdown-item:last-child {
  border-bottom: none;
}

.mention-dropdown-item:hover {
  background: #f3e8ff;
}

.mention-dropdown-item.highlighted {
  background: #ede9fe;
}

.mention-dropdown-item .avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ec4899, #8b5cf6);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 12px;
}

.mention-tag {
  background: linear-gradient(135deg, #ede9fe, #fce7f3);
  color: #7c3aed;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: 600;
}

.mention-everyone {
  background: linear-gradient(135deg, #fee2e2, #fef3c7);
  color: #dc2626;
}

/* Last Active Badge */
.last-active-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 10px;
  color: #6b7280;
  padding: 2px 6px;
  background: #f3f4f6;
  border-radius: 10px;
}

.last-active-badge.online {
  background: #d1fae5;
  color: #059669;
}

/* Notification sound indicator */
@keyframes bellRing {
  0%, 100% { transform: rotate(0); }
  25% { transform: rotate(10deg); }
  50% { transform: rotate(-10deg); }
  75% { transform: rotate(5deg); }
}

.bell-ringing {
  animation: bellRing 0.5s ease-in-out;
}

/* Comment reaction buttons - smaller size */
.comment-reactions .reaction-btn-wrapper .emoji-btn {
  padding: 2px 6px;
  font-size: 12px;
  background: transparent;
  min-height: auto;
}

.comment-reactions .reaction-btn-wrapper .emoji-btn:hover {
  background: #f3e8ff;
}

.comment-reactions .reaction-btn-wrapper .emoji-btn.active {
  background: #ede9fe;
}

.comment-reactions .reaction-tooltip {
  font-size: 10px;
  padding: 4px 8px;
}

/* ========================================
   HIDDEN EMOJI REACTIONS - Show on hover/tap
   ======================================== */
.comment-emoji-container {
  display: flex;
  align-items: center;
  gap: 2px;
}

/* Hide emoji buttons by default - only show counts if any */
.comment-emoji-container .emoji-btn:not(.has-reactions) {
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
}

/* Show on hover (desktop) */
.comment-wrapper:hover .comment-emoji-container .emoji-btn {
  opacity: 1;
  visibility: visible;
}

/* Touch device: show emoji picker button instead */
.comment-emoji-toggle {
  display: none;
  padding: 2px 8px;
  font-size: 14px;
  background: transparent;
  border: none;
  cursor: pointer;
  border-radius: 12px;
  min-height: auto;
}

.comment-emoji-toggle:hover {
  background: #f3e8ff;
}

/* Always show toggle on mobile */
@media (hover: none) {
  .comment-emoji-container .emoji-btn:not(.has-reactions) {
    display: none;
  }
  
  .comment-emoji-toggle {
    display: inline-flex;
  }
  
  .comment-emoji-container.emoji-picker-open .emoji-btn {
    display: inline-flex;
    opacity: 1;
    visibility: visible;
  }
}

/* ========================================
   REDDIT-STYLE THREADED COMMENTS
   ======================================== */
.reddit-comment-thread {
  position: relative;
  margin-left: 0;
}

.reddit-comment {
  position: relative;
  display: flex;
  gap: 8px;
}

.reddit-comment-thread .reddit-comment {
  margin-left: 32px;
  padding-left: 16px;
}

/* Vertical connecting line */
.reddit-comment-thread::before {
  content: '';
  position: absolute;
  left: 14px;
  top: 0;
  bottom: 16px;
  width: 2px;
  background: #e5e7eb;
  border-radius: 1px;
}

/* Collapse button */
.reddit-collapse-btn {
  position: absolute;
  left: 6px;
  top: 0;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  border: 2px solid #d1d5db;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  cursor: pointer;
  z-index: 5;
  color: #6b7280;
  transition: all 0.2s;
  min-height: auto;
  padding: 0;
}

.reddit-collapse-btn:hover {
  border-color: #9333ea;
  color: #9333ea;
  background: #faf5ff;
}

/* Collapsed thread */
.reddit-comment-thread.collapsed > .reddit-comment:not(:first-child) {
  display: none;
}

.reddit-comment-thread.collapsed::before {
  display: none;
}

/* Reply input */
.reddit-reply-input {
  margin-left: 48px;
  margin-top: 8px;
  padding: 8px 12px;
  background: #f9fafb;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
}

/* ‚úÖ IMPROVED: Reddit-style action button row */
.reddit-action-row {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 4px;
  margin-left: 2px;
}

.reddit-reply-btn {
  font-size: 12px;
  font-weight: 600;
  color: #878a8c;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  min-height: auto;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  transition: all 0.15s ease;
}

.reddit-reply-btn:hover {
  background: #f0f0f0;
  color: #1a1a1b;
}

.reddit-reply-btn:active {
  transform: scale(0.98);
}

/* Reddit-style vote/action buttons */
.reddit-action-btn {
  font-size: 12px;
  font-weight: 600;
  color: #878a8c;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  min-height: auto;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  transition: all 0.15s ease;
}

.reddit-action-btn:hover {
  background: #f0f0f0;
  color: #1a1a1b;
}

.reddit-action-btn.active {
  color: #ff4500;
}

.reddit-action-btn .icon {
  font-size: 14px;
}

/* Reddit-style separator dot */
.reddit-separator {
  color: #d1d5db;
  font-size: 3px;
  margin: 0 2px;
}

/* Reddit timestamp styling */
.reddit-timestamp {
  font-size: 12px;
  color: #787c7e;
}

/* Reddit author styling */
.reddit-author {
  font-size: 12px;
  font-weight: 600;
  color: #1c1c1c;
}

.reddit-author:hover {
  text-decoration: underline;
  cursor: pointer;
}

/* Reddit comment body */
.reddit-comment-body {
  font-size: 14px;
  line-height: 1.5;
  color: #1c1c1c;
  word-break: break-word;
}

/* Reddit reactions */
.reddit-reactions {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  padding: 2px 6px;
  background: #f6f7f8;
  border-radius: 12px;
  margin-left: 4px;
}

.reddit-reactions .emoji-btn {
  font-size: 14px;
  padding: 2px 4px;
  border-radius: 4px;
  min-height: auto;
  border: none;
  background: transparent;
  cursor: pointer;
  transition: transform 0.1s;
}

.reddit-reactions .emoji-btn:hover {
  transform: scale(1.2);
  background: #e8e9ea;
}

.reddit-reactions .emoji-btn.active {
  background: #ffe4d4;
}

/* Mobile responsive */
@media (max-width: 640px) {
  .reddit-reply-btn, .reddit-action-btn {
    padding: 6px 10px;
    font-size: 11px;
  }
  
  .reddit-action-row {
    flex-wrap: wrap;
    gap: 2px;
  }
}
    /* ========================================
   PWA ENHANCEMENT STYLES - Added for offline support
   ======================================== */

/* Network Status Indicator */
.pwa-network-status {
  position: fixed;
  top: 10px;
  right: 70px;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  z-index: 9998;
  transition: all 0.3s ease;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.pwa-network-status.online {
  background: rgba(34, 197, 94, 0.15);
  color: #16a34a;
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.pwa-network-status.offline {
  background: rgba(239, 68, 68, 0.15);
  color: #dc2626;
  border: 1px solid rgba(239, 68, 68, 0.3);
  animation: pwa-pulse 2s infinite;
}

.pwa-network-status .status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.pwa-network-status.online .status-dot { background: #22c55e; }
.pwa-network-status.offline .status-dot { background: #ef4444; animation: pwa-blink 1s infinite; }

@keyframes pwa-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
@keyframes pwa-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

/* Pending Sync Badge */
.pwa-pending-badge {
  position: fixed;
  bottom: 80px;
  right: 20px;
  display: none;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  z-index: 9997;
  box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
}

.pwa-pending-badge.show { display: flex; }
.pwa-pending-badge i { animation: pwa-spin 2s linear infinite; }

@keyframes pwa-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* PWA Toast */
.pwa-toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  padding: 14px 24px;
  border-radius: 12px;
  color: white;
  font-size: 14px;
  font-weight: 500;
  z-index: 99999;
  box-shadow: 0 4px 20px rgba(0,0,0,0.25);
  animation: pwa-toastIn 0.3s ease;
  max-width: 90%;
  text-align: center;
  transition: all 0.3s ease;
}

.pwa-toast.success { background: linear-gradient(135deg, #10b981, #059669); }
.pwa-toast.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
.pwa-toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
.pwa-toast.info { background: linear-gradient(135deg, #3b82f6, #2563eb); }

@keyframes pwa-toastIn { from { transform: translateX(-50%) translateY(30px); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }

@media (max-width: 768px) {
  .pwa-network-status { top: auto; bottom: 70px; right: 10px; padding: 5px 10px; font-size: 11px; }
  .pwa-pending-badge { bottom: 120px; right: 10px; }
}
  </style>

  <!-- ‚úÖ PERFORMANCE: Scripts with defer download in parallel, execute in order -->
  <!-- This eliminates render-blocking and reduces LCP from 10s to ~2s -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script defer src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- ‚úÖ PERFORMANCE FIX v5.2: Tailwind CDN REMOVED ‚Äî saves 3MB+ download -->
  <!-- Using pre-built tailwind-static.css instead (generated during Vercel build) -->
  <!-- Inline fallback CSS above ensures styles work even offline -->
  <!-- Non-critical libraries - download in parallel, execute before app -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script defer src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <script defer src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/otpauth/9.2.2/otpauth.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <script defer src="/init.js?v=5.2.0"></script>

</head>
<body>
  <!-- ========================================
       APP SHELL - INSTANT UI DISPLAY
       This shows the actual app interface IMMEDIATELY,
       just like Instagram, Twitter, and modern apps.
       Users see the real UI with skeleton placeholders,
       not a loading spinner!
       ======================================== -->
  
  <!-- App Shell - Shows instantly before JavaScript loads -->
  <div id="app-shell" class="app-shell">
    <!-- Sidebar -->
    <aside class="shell-sidebar">
      <div class="shell-logo">
        <div class="shell-logo-icon">üìö</div>
        <div class="shell-logo-text">Curriculum<br/>Tracker</div>
      </div>
      <nav class="shell-nav">
        <div class="shell-nav-item active">
          <span class="shell-nav-icon">üìä</span>
          <span>Dashboard</span>
        </div>
        <div class="shell-nav-item">
          <span class="shell-nav-icon">üìà</span>
          <span>Analytics</span>
        </div>
        <div class="shell-nav-item">
          <span class="shell-nav-icon">üìñ</span>
          <span>Class 11</span>
        </div>
        <div class="shell-nav-item">
          <span class="shell-nav-icon">üìñ</span>
          <span>Class 12</span>
        </div>
        <div class="shell-nav-item">
          <span class="shell-nav-icon">üë•</span>
          <span>Directory</span>
        </div>
        <div class="shell-nav-item">
          <span class="shell-nav-icon">‚úÖ</span>
          <span>Attendance</span>
        </div>
      </nav>
    </aside>
    
    <!-- Main Content with Skeleton Placeholders -->
    <main class="shell-main">
      <!-- Header -->
      <div class="shell-header">
        <h1 class="shell-title">Dashboard Overview</h1>
        <div class="shell-user">
          <div class="shell-avatar"></div>
        </div>
      </div>
      
      <!-- Stats Cards - Skeleton with gradient backgrounds -->
      <div class="shell-stats-grid">
        <div class="shell-stat-card yellow">
          <div class="shell-stat-label">Your School Rank</div>
          <div class="shell-stat-value">#--</div>
          <div class="shell-stat-sub">Loading schools...</div>
        </div>
        <div class="shell-stat-card green">
          <div class="shell-stat-label">Best Performing School</div>
          <div class="shell-stat-value" style="font-size: 18px;">Loading...</div>
          <div class="shell-stat-sub">--% completed</div>
        </div>
        <div class="shell-stat-card red">
          <div class="shell-stat-label">Lagging Subject</div>
          <div class="shell-stat-value" style="font-size: 18px;">Loading...</div>
          <div class="shell-stat-sub">--% completed</div>
        </div>
      </div>
      
      <!-- School Rankings Card - Skeleton -->
      <div class="shell-card">
        <div class="shell-card-title">üèÜ School Rankings</div>
        <div class="shell-ranking-item">
          <div class="shell-ranking-num">#1</div>
          <div class="shell-ranking-info">
            <div class="skeleton skeleton-text medium"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
          <div class="shell-ranking-percent">--</div>
        </div>
        <div class="shell-ranking-item">
          <div class="shell-ranking-num">#2</div>
          <div class="shell-ranking-info">
            <div class="skeleton skeleton-text medium"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
          <div class="shell-ranking-percent">--</div>
        </div>
        <div class="shell-ranking-item">
          <div class="shell-ranking-num">#3</div>
          <div class="shell-ranking-info">
            <div class="skeleton skeleton-text medium"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
          <div class="shell-ranking-percent">--</div>
        </div>
        <div class="shell-ranking-item">
          <div class="shell-ranking-num">#4</div>
          <div class="shell-ranking-info">
            <div class="skeleton skeleton-text medium"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
          <div class="shell-ranking-percent">--</div>
        </div>
      </div>
      
      <!-- Subject Performance Card - Skeleton -->
      <div class="shell-card">
        <div class="shell-card-title">üìö Subject Performance</div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
          <div style="padding: 16px; border: 2px solid #eee; border-radius: 12px;">
            <div class="skeleton skeleton-text short"></div>
            <div style="height: 8px; background: #eee; border-radius: 4px; margin-top: 12px;">
              <div class="skeleton" style="width: 60%; height: 100%; border-radius: 4px;"></div>
            </div>
          </div>
          <div style="padding: 16px; border: 2px solid #eee; border-radius: 12px;">
            <div class="skeleton skeleton-text short"></div>
            <div style="height: 8px; background: #eee; border-radius: 4px; margin-top: 12px;">
              <div class="skeleton" style="width: 45%; height: 100%; border-radius: 4px;"></div>
            </div>
          </div>
          <div style="padding: 16px; border: 2px solid #eee; border-radius: 12px;">
            <div class="skeleton skeleton-text short"></div>
            <div style="height: 8px; background: #eee; border-radius: 4px; margin-top: 12px;">
              <div class="skeleton" style="width: 75%; height: 100%; border-radius: 4px;"></div>
            </div>
          </div>
          <div style="padding: 16px; border: 2px solid #eee; border-radius: 12px;">
            <div class="skeleton skeleton-text short"></div>
            <div style="height: 8px; background: #eee; border-radius: 4px; margin-top: 12px;">
              <div class="skeleton" style="width: 55%; height: 100%; border-radius: 4px;"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <!-- Loading Status Badge (bottom right) -->
    <div id="shell-loading-status" class="shell-loading-status">
      <div class="shell-loading-spinner"></div>
      <span id="shell-status-text">Loading data...</span>
    </div>
  </div>
  
  <!-- ========================================
       FALLBACK LOADER (legacy - hidden by default)
       Only shows if app shell fails
       ======================================== -->
  <div id="instant-loader" class="instant-loader">
    <div class="instant-loader-logo">üìö</div>
    <div class="instant-loader-text">Curriculum Tracker</div>
    <div class="instant-loader-sub">Avanti Fellows</div>
    <div class="loader-dots">
      <div class="loader-dot"></div>
      <div class="loader-dot"></div>
      <div class="loader-dot"></div>
    </div>
    <!-- ‚úÖ NEW: Slow connection message for iOS/low connectivity -->
    <div class="loader-timeout-msg">
      Loading is taking longer than usual.<br/>
      This may be due to slow network.
      <br/>
      <button class="retry-btn" onclick="location.reload()">‚Üª Tap to Retry</button>
    </div>
  </div>
  
  <div id="root"></div>
  <!-- PWA Network Status Indicator -->
<div id="pwa-network-status" class="pwa-network-status online">
  <span class="status-dot"></span>
  <span class="status-text">Online</span>
</div>

<!-- PWA Pending Sync Badge -->
<div id="pwa-pending-badge" class="pwa-pending-badge">
  <i class="fa-solid fa-sync"></i>
  <span id="pwa-pending-count">0</span> items pending sync
</div>
  
  <script>
  // ‚úÖ APP SHELL ARCHITECTURE: Hide app shell once React app renders
  // This function is called when the React app is ready to show
  window.hideInstantLoader = function() {
    // ‚úÖ iOS FIX: Clear timeout handlers
    if (window._loaderTimeoutId) clearTimeout(window._loaderTimeoutId);
    if (window._forceHideTimeout) clearTimeout(window._forceHideTimeout);
    
    // ‚úÖ PERFORMANCE: Log load time
    if (window.__PERF_START) {
      var loadTime = ((performance.now() - window.__PERF_START) / 1000).toFixed(2);
      console.log('‚ö° App fully loaded in ' + loadTime + ' seconds');
    }
    
    // ‚úÖ CLS FIX: Hide with opacity transition (no layout shift!)
    const appShell = document.getElementById('app-shell');
    if (appShell) {
      appShell.classList.add('hidden');
      console.log('‚úÖ [App Shell] Fading out - React app is ready');
      // Remove from DOM after transition completes
      setTimeout(() => {
        if (appShell && appShell.parentNode) {
          appShell.parentNode.removeChild(appShell);
        }
      }, 400);
    }
    
    // Also hide legacy loader if visible
    const loader = document.getElementById('instant-loader');
    if (loader) {
      loader.style.transition = 'opacity 0.3s ease';
      loader.style.opacity = '0';
      setTimeout(() => {
        if (loader && loader.parentNode) {
          loader.parentNode.removeChild(loader);
        }
      }, 300);
    }
  };
  
  // ‚úÖ NEW: Force hide app shell after 5 seconds no matter what
  // This ensures the shell never blocks the UI indefinitely
  window._forceHideTimeout = setTimeout(function() {
    console.log('‚è±Ô∏è [App Shell] Force hiding after timeout');
    window.hideInstantLoader();
  }, 5000);
  
  // ‚úÖ APP SHELL: Update loading status indicator
  // This shows users what's happening while the app loads
  window.updateShellStatus = function(message, isComplete = false) {
    const statusEl = document.getElementById('shell-loading-status');
    const textEl = document.getElementById('shell-status-text');
    
    if (textEl) {
      textEl.textContent = message;
    }
    
    if (statusEl && isComplete) {
      statusEl.classList.add('success');
      statusEl.querySelector('.shell-loading-spinner')?.remove();
      setTimeout(() => {
        statusEl.classList.add('hidden');
      }, 1500);
    }
  };
  
  // ‚úÖ APP SHELL: Update skeleton data with cached values
  // This fills in the skeleton placeholders with cached data instantly
  window.updateShellWithCache = function() {
    try {
      const cachedAppData = localStorage.getItem('cachedAppData');
      if (cachedAppData) {
        const data = JSON.parse(cachedAppData);
        const statusText = document.getElementById('shell-status-text');
        if (statusText) {
          statusText.textContent = 'Loading from cache...';
        }
        console.log('‚úÖ [App Shell] Loaded cached data for instant display');
      }
    } catch (e) {
      console.log('[App Shell] No cached data available');
    }
  };
  
  // Load cached data immediately when page loads
  window.updateShellWithCache();
  </script>
  
  <!-- ‚úÖ INP FIX: Helpers to break up long tasks and keep UI responsive -->
  <script>
  window.yieldToMain = function() { return new Promise(function(r) { setTimeout(r, 0); }); };
  window.scheduleIdle = function(fn) {
    if ('requestIdleCallback' in window) requestIdleCallback(fn, { timeout: 2000 });
    else setTimeout(fn, 100);
  };
  </script>

  <!-- ‚úÖ PERFORMANCE: Main app code loaded as deferred external script -->
  <!-- Downloads in parallel with HTML parsing, executes after DOM ready -->
  <script defer src="/app.js?v=5.2.0"></script>
  <!-- PWA management moved to post-app.js -->
  <script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>
<script defer src="/_vercel/speed-insights/script.js"></script>

<!-- START: Global saving-indicator + Firestore write wrapper (added by ChatGPT) -->
<style>
/* simple overlay */
#__global_saving_overlay {
  position: fixed;
  right: 16px;
  bottom: 16px;
  background: rgba(0,0,0,0.75);
  color: white;
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 600;
  z-index: 99999;
  display: none;
  align-items: center;
  gap: 8px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  backdrop-filter: blur(4px);
}
.__saving_spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255,255,255,0.25);
  border-top-color: white;
  border-radius: 50%;
  animation: __spin 1s linear infinite;
}
@keyframes __spin { to { transform: rotate(360deg); } }

/* ‚úÖ REMOVED: pointer-events: none was breaking all buttons */
/* disabled appearance when saving - ONLY opacity, NOT pointer-events */
.__global_saving_disabled {
  opacity: 0.7 !important;
}
</style>

<div id="__global_saving_overlay" aria-live="polite" role="status">
  <div class="__saving_spinner" aria-hidden="true"></div>
  <div>Saving‚Ä¶</div>
</div>

  <script defer src="/post-app.js?v=5.2.0"></script>
<script src="avanti-widget.js" onerror="console.warn('‚ö†Ô∏è avanti-widget.js failed to load - chatbot disabled')"></script>


<!-- ============================================
     GLOBAL NOTIFICATION SYSTEM
     For entire Curriculum Tracker app
============================================ -->
<style>
/* Notification Bell - Top Right Position */
.notification-bell {
    position: fixed;
    top: 20px;
    right: 80px;
    z-index: 9998;
    background: #12121a;
    border: 1px solid #2a2a3a;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer !important;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    pointer-events: auto !important;
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgba(244, 180, 26, 0.3);
    user-select: none;
    -webkit-user-select: none;
}

/* ‚úÖ FIX: Bell is ALWAYS visible, only style changes when all read */
/* Removed hiding behavior - bell should always show */
.notification-bell.all-read {
    /* Bell remains visible but looks less prominent */
    opacity: 0.7;
    background: #1a1a24;
}

.notification-bell.all-read:hover {
    opacity: 1;
}

.notification-bell:hover {
    background: #1a1a24;
    transform: scale(1.05);
}

.notification-bell .bell-icon {
    font-size: 20px;
}

.notification-bell .badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ef4444;
    color: white;
    font-size: 11px;
    font-weight: 700;
    min-width: 18px;
    height: 18px;
    border-radius: 9px;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
}

.notification-bell .badge.show {
    display: flex;
}

/* Notification Panel - Top Right Position */
.notification-panel {
    position: fixed;
    top: 70px;
    right: 20px;
    width: 340px;
    max-height: 450px;
    background: #12121a;
    border: 1px solid #2a2a3a;
    border-radius: 16px;
    z-index: 9997;
    display: none;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    overflow: hidden;
}

.notification-panel.show {
    display: flex;
}

.notification-panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid #2a2a3a;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-panel-header h3 {
    color: #F4B41A;
    font-size: 16px;
    font-weight: 600;
}

.notification-panel-header button {
    background: none;
    border: none;
    color: #8a8a9a;
    cursor: pointer;
    font-size: 12px;
}

.notification-panel-header button:hover {
    color: #F4B41A;
}

.notification-panel-body {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
}

.notification-item {
    background: #1a1a24;
    border: 1px solid #2a2a3a;
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s;
}

.notification-item:hover {
    border-color: #F4B41A;
}

.notification-item.unread {
    border-left: 3px solid #F4B41A;
}

.notification-item .title {
    color: #fff;
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 6px;
}

.notification-item .message {
    color: #8a8a9a;
    font-size: 13px;
    line-height: 1.4;
}

.notification-item .time {
    color: #5a5a6a;
    font-size: 11px;
    margin-top: 8px;
}

/* Notification Expansion Popup */
.notification-expansion-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.notification-expansion-popup {
    background: #12121a;
    border: 1px solid #2a2a3a;
    border-radius: 16px;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}

.notification-expansion-header {
    padding: 16px 20px;
    border-bottom: 1px solid #2a2a3a;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-expansion-header h3 {
    color: #F4B41A;
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.notification-expansion-close {
    background: none;
    border: none;
    color: #8a8a9a;
    font-size: 24px;
    cursor: pointer;
    transition: color 0.2s;
}

.notification-expansion-close:hover {
    color: #fff;
}

.notification-expansion-body {
    padding: 20px;
    overflow-y: auto;
    max-height: calc(80vh - 150px);
}

.notification-expansion-message {
    color: #e0e0e0;
    font-size: 15px;
    line-height: 1.6;
    white-space: pre-wrap;
    margin-bottom: 16px;
}

.notification-expansion-meta {
    color: #6a6a7a;
    font-size: 12px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #2a2a3a;
}

.notification-expansion-actions {
    padding: 16px 20px;
    border-top: 1px solid #2a2a3a;
    display: flex;
    gap: 12px;
}

.notification-expansion-actions button {
    flex: 1;
    padding: 12px 20px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.notification-reply-btn {
    background: #F4B41A;
    color: #000;
    border: none;
}

.notification-reply-btn:hover {
    background: #e5a617;
}

.notification-close-btn {
    background: #2a2a3a;
    color: #fff;
    border: 1px solid #3a3a4a;
}

.notification-close-btn:hover {
    background: #3a3a4a;
}

.notification-empty {
    text-align: center;
    padding: 40px 20px;
    color: #5a5a6a;
}

.notification-empty .icon {
    font-size: 40px;
    margin-bottom: 12px;
}

/* Enable notifications banner */
.enable-notifications-banner {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 12px 16px;
    margin: 12px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.enable-notifications-banner .text {
    flex: 1;
    color: #fff;
    font-size: 12px;
}

.enable-notifications-banner .btn {
    background: #fff;
    color: #667eea;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
}

@media (max-width: 480px) {
    .notification-bell {
        top: 15px;
        right: 70px;
        width: 38px;
        height: 38px;
    }
    
    .notification-panel {
        top: 60px;
        right: 10px;
        left: 10px;
        width: auto;
    }
}
</style>

<!-- Notification Bell -->
<div class="notification-bell" id="notificationBell" onclick="event.stopPropagation(); NotificationManager.togglePanel();" role="button" tabindex="0">
    <span class="bell-icon">üîî</span>
    <span class="badge" id="notificationBadge">0</span>
</div>

<!-- Notification Panel -->
<div class="notification-panel" id="notificationPanel" onclick="event.stopPropagation();">
    <div class="notification-panel-header">
        <h3>üîî Notifications</h3>
        <button onclick="event.stopPropagation(); NotificationManager.markAllRead();">Mark all read</button>
    </div>
    <div class="notification-panel-body" id="notificationList">
        <!-- Notifications loaded here -->
    </div>
</div>

<!-- PWA Sync Handlers -->
<script>
// Listen for sync events from PWA Manager
window.addEventListener('syncAttendance', async (event) => {
  const data = event.detail;
  console.log('[Sync] Syncing attendance:', data);
  
  try {
    if (typeof firebase !== 'undefined' && firebase.firestore) {
      const docId = data.docId || `${data.school}_${data.grade}_${data.studentId}_${data.date}`;
      await firebase.firestore().collection('studentAttendance').doc(docId).set({
        school: data.school,
        grade: data.grade,
        studentId: data.studentId,
        studentName: data.studentName,
        date: data.date,
        status: data.status,
        remarks: data.remarks || '',
        markedBy: data.markedBy,
        markedAt: data.markedAt,
        syncedAt: new Date().toISOString(),
        wasOffline: true
      });
      console.log('[Sync] ‚úÖ Attendance synced:', docId);
    }
  } catch (error) {
    console.error('[Sync] ‚ùå Failed to sync attendance:', error);
  }
});

// Listen for curriculum sync
window.addEventListener('syncCurriculum', async (event) => {
  const data = event.detail;
  console.log('[Sync] Syncing curriculum:', data);
  
  try {
    if (typeof firebase !== 'undefined' && firebase.firestore) {
      await firebase.firestore().collection('curriculum_progress').add({
        ...data,
        syncedAt: new Date().toISOString(),
        wasOffline: true
      });
      console.log('[Sync] ‚úÖ Curriculum synced');
    }
  } catch (error) {
    console.error('[Sync] ‚ùå Failed to sync curriculum:', error);
  }
});

// Listen for feedback sync
window.addEventListener('syncFeedback', async (event) => {
  const data = event.detail;
  console.log('[Sync] Syncing feedback:', data);
  
  try {
    if (typeof firebase !== 'undefined' && firebase.firestore) {
      await firebase.firestore().collection('student_feedback').add({
        ...data,
        syncedAt: new Date().toISOString(),
        wasOffline: true
      });
      console.log('[Sync] ‚úÖ Feedback synced');
    }
  } catch (error) {
    console.error('[Sync] ‚ùå Failed to sync feedback:', error);
  }
});

console.log('[PWA] Sync handlers registered');
</script>
<!-- Add before closing </body> tag -->
<script src="/pwa-manager.js"></script>
<!-- PWA Install Prompt moved to post-app.js -->
</body>
</html>
